<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StudioLoop Trainer Dashboard</title>
    
    <!-- External Dependencies -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <style>
        /* Brand Variables */
        :root {
            --sl-brand: #0077ff;
            --sl-brand-700: #0057cc;
            --sl-brand-900: #0f2b6b;
            --sl-accent-aqua: #00e5ff;
            --sl-accent-violet: #8e24aa;
            --sl-accent-peach: #ff8a65;
            --sl-neutral-0: #ffffff;
            --sl-neutral-25: #fcfcfd;
            --sl-neutral-50: #f8fafc;
            --sl-neutral-100: #f1f5f9;
            --sl-neutral-200: #e5e7eb;
            --sl-neutral-300: #d1d5db;
            --sl-neutral-400: #9ca3af;
            --sl-neutral-500: #6b7280;
            --sl-neutral-600: #4b5563;
            --sl-neutral-700: #374151;
            --sl-neutral-800: #1f2937;
            --sl-neutral-900: #0f172a;
            --sl-grad-1: linear-gradient(45deg, #00e5ff, #8e24aa);
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --info: #3b82f6;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
            background: var(--sl-neutral-50);
            color: var(--sl-neutral-700);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Sidebar Navigation */
        .sidebar {
            background: var(--sl-neutral-0);
            border-right: 1px solid var(--sl-neutral-200);
            padding: 24px 0;
            overflow-y: auto;
            position: fixed;
            height: 100vh;
            width: 280px;
            z-index: 100;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 0 24px 32px;
            border-bottom: 1px solid var(--sl-neutral-200);
            margin-bottom: 32px;
        }

        .logo {
            width: 40px;
            height: 40px;
            color: var(--sl-brand);
        }

        .logo-text {
            font-size: 24px;
            font-weight: 700;
            background: var(--sl-grad-1);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .nav-menu {
            list-style: none;
        }

        .nav-item {
            margin-bottom: 4px;
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 14px;
            padding: 14px 24px;
            text-decoration: none;
            color: var(--sl-neutral-600);
            font-weight: 500;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border-right: 3px solid transparent;
            position: relative;
            border-radius: 0 12px 12px 0;
            margin-right: 16px;
        }
        
        .nav-link::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 0;
            background: var(--sl-brand);
            transition: width 0.3s ease;
        }

        .nav-link:hover {
            background: var(--sl-neutral-50);
            color: var(--sl-brand);
            transform: translateX(4px);
        }
        
        .nav-link:hover::before {
            width: 3px;
        }

        .nav-link.active {
            background: rgba(0, 119, 255, 0.1);
            color: var(--sl-brand);
            border-right-color: var(--sl-brand);
            font-weight: 600;
        }
        
        .nav-link.active::before {
            width: 3px;
        }

        .nav-link i {
            width: 20px;
            text-align: center;
            font-size: 18px;
        }

        /* Main Content */
        .main-content {
            margin-left: 280px;
            min-height: 100vh;
            background: var(--sl-neutral-50);
            width: calc(100vw - 280px);
            position: relative;
        }

        /* Ensure proper desktop layout */
        @media (min-width: 1200px) {
            .main-content {
                max-width: none;
                width: calc(100vw - 280px);
            }
            
            .dashboard-content {
                width: 100%;
                padding: 32px 40px;
            }
        }

        .header {
            background: var(--sl-neutral-0);
            border-bottom: 1px solid var(--sl-neutral-200);
            padding: 16px 32px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 50;
        }

        .header-title {
            font-size: 28px;
            font-weight: 700;
            color: var(--sl-neutral-900);
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .notification-bell {
            position: relative;
            background: var(--sl-neutral-100);
            border: none;
            border-radius: 12px;
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: var(--sl-neutral-600);
            transition: all 0.2s ease;
        }

        .notification-bell:hover {
            background: var(--sl-neutral-200);
        }

        .notification-badge {
            position: absolute;
            top: 6px;
            right: 6px;
            background: var(--danger);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 12px;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px 16px;
            background: var(--sl-neutral-100);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .user-menu:hover {
            background: var(--sl-neutral-200);
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--sl-grad-1);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 16px;
        }

        .user-info h4 {
            font-size: 14px;
            font-weight: 600;
            color: var(--sl-neutral-900);
        }

        .user-info p {
            font-size: 12px;
            color: var(--sl-neutral-500);
        }

        /* Dashboard Content */
        .dashboard-content {
            padding: 32px;
            width: 100%;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 32px;
            margin-bottom: 32px;
        }

        /* Desktop-first responsive design */
        @media (min-width: 1200px) {
            .dashboard-grid {
                grid-template-columns: 2fr 1fr;
                gap: 40px;
            }
        }

        /* Metrics Cards */
        .metrics-section {
            display: grid;
            gap: 24px;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        /* Enhanced desktop metrics layout */
        @media (min-width: 1200px) {
            .metrics-grid {
                grid-template-columns: repeat(4, 1fr);
                gap: 24px;
            }
        }

        @media (min-width: 1400px) {
            .metrics-grid {
                grid-template-columns: repeat(4, 1fr);
                gap: 28px;
            }
        }

        .metric-card {
            background: var(--sl-neutral-0);
            border-radius: 16px;
            padding: 24px;
            border: 1px solid var(--sl-neutral-200);
            transition: all 0.3s ease;
        }

        .metric-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        .metric-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .metric-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
        }

        .metric-icon.earnings {
            background: var(--success);
        }

        .metric-icon.classes {
            background: var(--sl-brand);
        }

        .metric-icon.students {
            background: var(--sl-accent-violet);
        }

        .metric-icon.attendance {
            background: var(--sl-accent-peach);
        }

        .metric-value {
            font-size: 36px;
            font-weight: 800;
            color: var(--sl-neutral-900);
            margin-bottom: 8px;
            letter-spacing: -0.025em;
            line-height: 1;
        }

        .metric-label {
            font-size: 14px;
            font-weight: 600;
            color: var(--sl-neutral-500);
            margin-bottom: 16px;
            text-transform: uppercase;
            letter-spacing: 0.75px;
        }

        .metric-change {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 13px;
            font-weight: 600;
            padding: 4px 8px;
            border-radius: 6px;
            background: var(--sl-neutral-50);
            width: fit-content;
        }

        .metric-change.positive {
            color: var(--success);
            background: rgba(16, 185, 129, 0.1);
        }

        .metric-change.negative {
            color: var(--danger);
            background: rgba(239, 68, 68, 0.1);
        }

        .metric-change i {
            font-size: 11px;
        }

        /* Quick Actions */
        .quick-actions {
            background: var(--sl-neutral-0);
            border-radius: 16px;
            padding: 24px;
            border: 1px solid var(--sl-neutral-200);
        }

        .section-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--sl-neutral-900);
            margin-bottom: 20px;
        }

        .action-grid {
            display: grid;
            gap: 12px;
        }

        .action-btn {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 16px;
            background: var(--sl-neutral-50);
            border: 1px solid var(--sl-neutral-200);
            border-radius: 12px;
            text-decoration: none;
            color: var(--sl-neutral-700);
            font-weight: 500;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .action-btn:hover {
            background: var(--sl-brand);
            color: white;
            transform: translateX(4px);
        }

        /* Schedule Section */
        .schedule-section {
            background: var(--sl-neutral-0);
            border-radius: 16px;
            padding: 24px;
            border: 1px solid var(--sl-neutral-200);
        }

        .schedule-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .schedule-date {
            font-size: 16px;
            color: var(--sl-neutral-500);
        }

        .class-list {
            display: grid;
            gap: 16px;
        }

        .class-card {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 20px;
            background: var(--sl-neutral-50);
            border-radius: 12px;
            border-left: 4px solid var(--sl-brand);
            transition: all 0.3s ease;
        }

        .class-card:hover {
            background: var(--sl-neutral-100);
            transform: translateX(4px);
        }

        .class-time {
            font-size: 16px;
            font-weight: 700;
            color: var(--sl-brand);
            min-width: 60px;
        }

        .class-info h4 {
            font-size: 16px;
            font-weight: 600;
            color: var(--sl-neutral-900);
            margin-bottom: 4px;
        }

        .class-details {
            font-size: 14px;
            color: var(--sl-neutral-500);
            display: flex;
            gap: 16px;
        }

        .class-status {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-left: auto;
        }

        .class-status.confirmed {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success);
        }

        .class-status.pending {
            background: rgba(245, 158, 11, 0.1);
            color: var(--warning);
        }

        /* Content Sections */
        .content-sections {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 32px;
            margin-bottom: 32px;
        }

        .content-section {
            background: var(--sl-neutral-0);
            border-radius: 16px;
            padding: 24px;
            border: 1px solid var(--sl-neutral-200);
        }

        /* Students Section */
        .student-list {
            display: grid;
            gap: 16px;
            max-height: 400px;
            overflow-y: auto;
        }

        .student-card {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 16px;
            background: var(--sl-neutral-50);
            border-radius: 12px;
            transition: all 0.2s ease;
        }

        .student-card:hover {
            background: var(--sl-neutral-100);
        }

        .student-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: var(--sl-grad-1);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 18px;
        }

        .student-info h4 {
            font-size: 14px;
            font-weight: 600;
            color: var(--sl-neutral-900);
            margin-bottom: 4px;
        }

        .student-info p {
            font-size: 12px;
            color: var(--sl-neutral-500);
        }

        .student-stats {
            margin-left: auto;
            text-align: right;
        }

        .student-stats .classes-attended {
            font-size: 14px;
            font-weight: 600;
            color: var(--sl-brand);
        }

        .student-stats .last-visit {
            font-size: 12px;
            color: var(--sl-neutral-500);
        }

        /* Analytics Chart */
        .chart-container {
            height: 400px;
            position: relative;
            background: var(--sl-neutral-0);
            border-radius: 16px;
            padding: 24px;
            border: 1px solid var(--sl-neutral-200);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .chart-container:hover {
            box-shadow: 0 4px 12px rgba(0, 119, 255, 0.1);
        }

        .chart-container canvas {
            border-radius: 8px;
        }
        
        .chart-controls {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
        }

        .chart-controls .chart-period-group {
            display: flex;
            gap: 8px;
        }

        .chart-controls .btn {
            border: 1px solid var(--sl-neutral-300);
            background: var(--sl-neutral-100);
            color: var(--sl-neutral-700);
            border-radius: 8px;
            padding: 8px 16px;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .chart-controls .btn:hover {
            background: var(--sl-neutral-200);
            border-color: var(--sl-neutral-400);
        }

        .chart-controls .btn.active {
            background: var(--sl-brand);
            border-color: var(--sl-brand);
            color: white;
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .chart-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--sl-neutral-900);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .chart-subtitle {
            font-size: 14px;
            color: var(--sl-neutral-500);
            margin-top: 4px;
        }
        
        .chart-controls .btn.active {
            background: var(--sl-brand) !important;
            color: white !important;
            border-color: var(--sl-brand);
        }
        
        .chart-controls .btn:not(.active):hover {
            background: var(--sl-neutral-300);
            border-color: var(--sl-neutral-400);
        }

        /* Notifications Panel */
        .notifications-section {
            grid-column: 1 / -1;
            background: var(--sl-neutral-0);
            border-radius: 16px;
            padding: 24px;
            border: 1px solid var(--sl-neutral-200);
        }

        .notifications-list {
            display: grid;
            gap: 16px;
        }

        .notification-item {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 16px;
            background: var(--sl-neutral-50);
            border-radius: 12px;
            border-left: 4px solid;
        }

        .notification-item.booking {
            border-left-color: var(--success);
        }

        .notification-item.cancellation {
            border-left-color: var(--danger);
        }

        .notification-item.payment {
            border-left-color: var(--sl-brand);
        }

        .notification-item.system {
            border-left-color: var(--warning);
        }

        .notification-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            color: white;
        }

        .notification-content {
            flex: 1;
        }

        .notification-content h4 {
            font-size: 14px;
            font-weight: 600;
            color: var(--sl-neutral-900);
            margin-bottom: 4px;
        }

        .notification-content p {
            font-size: 12px;
            color: var(--sl-neutral-500);
        }

        .notification-time {
            font-size: 12px;
            color: var(--sl-neutral-400);
        }

        /* Load Shedding Alert */
        .load-shedding-alert {
            background: linear-gradient(135deg, var(--warning), #f97316);
            color: white;
            padding: 20px;
            border-radius: 16px;
            margin-bottom: 28px;
            display: flex;
            align-items: center;
            gap: 16px;
            box-shadow: 0 4px 20px rgba(245, 158, 11, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
            position: relative;
            overflow: hidden;
        }
        
        .load-shedding-alert::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 100%;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 20" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="1"><path d="M0,10 L20,10 M30,10 L50,10 M60,10 L80,10 M90,10 L100,10"/></svg>');
            opacity: 0.3;
        }

        .load-shedding-alert .icon {
            font-size: 24px;
            animation: pulse 2s infinite;
            background: rgba(255, 255, 255, 0.2);
            padding: 12px;
            border-radius: 50%;
            z-index: 1;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .load-shedding-alert .content {
            flex: 1;
            z-index: 1;
        }

        .load-shedding-alert h4 {
            font-weight: 700;
            margin-bottom: 6px;
            font-size: 16px;
        }

        .load-shedding-alert p {
            font-size: 14px;
            opacity: 0.95;
            line-height: 1.4;
        }
        
        .load-shedding-alert .dismiss-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            z-index: 1;
        }
        
        .load-shedding-alert .dismiss-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(2px);
        }

        .modal.active {
            display: flex;
        }
        
        .modal:focus-within {
            outline: none;
        }

        .modal-content {
            background: var(--sl-neutral-0);
            border-radius: 16px;
            padding: 32px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            outline: none;
        }
        
        .modal-content:focus {
            outline: 2px solid var(--sl-brand);
            outline-offset: 2px;
        }

        .modal-content.large {
            max-width: 900px;
            max-height: 90vh;
        }

        .member-search {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
            align-items: center;
            flex-wrap: wrap;
        }

        .search-input {
            flex: 1;
            min-width: 250px;
            padding-left: 44px !important;
            background: var(--sl-neutral-50) !important;
        }
        
        .search-input:focus {
            background: var(--sl-neutral-0) !important;
        }
        
        .search-wrapper {
            position: relative;
            flex: 1;
            min-width: 250px;
        }
        
        .search-wrapper::before {
            content: '\f002';
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--sl-neutral-400);
            font-size: 14px;
            z-index: 1;
            pointer-events: none;
        }

        .filter-select {
            min-width: 180px;
            background: var(--sl-neutral-50) !important;
        }
        
        .filter-select:focus {
            background: var(--sl-neutral-0) !important;
        }
        
        .member-search-actions {
            display: flex;
            gap: 12px;
            align-items: center;
        }
        
        .member-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 20px;
            margin-bottom: 24px;
        }
        
        .member-stat {
            background: var(--sl-neutral-0);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid var(--sl-neutral-200);
            text-align: center;
            transition: all 0.2s ease;
        }
        
        .member-stat:hover {
            box-shadow: 0 4px 12px rgba(0, 119, 255, 0.1);
            transform: translateY(-2px);
        }
        
        .member-stat-value {
            font-size: 28px;
            font-weight: 800;
            color: var(--sl-brand);
            margin-bottom: 4px;
            letter-spacing: -0.025em;
        }
        
        .member-stat-label {
            font-size: 13px;
            color: var(--sl-neutral-500);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .member-grid {
            display: grid;
            gap: 16px;
            max-height: 400px;
            overflow-y: auto;
            margin-bottom: 20px;
        }

        .member-item {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 16px;
            background: var(--sl-neutral-50);
            border-radius: 12px;
            border: 1px solid var(--sl-neutral-200);
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .member-item:hover {
            background: var(--sl-neutral-100);
            border-color: var(--sl-brand);
        }

        .member-item.selected {
            background: rgba(0, 119, 255, 0.1);
            border-color: var(--sl-brand);
        }

        .member-avatar {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: var(--sl-grad-1);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 20px;
            flex-shrink: 0;
            position: relative;
            box-shadow: 0 4px 12px rgba(0, 119, 255, 0.2);
        }
        
        .member-avatar::after {
            content: '';
            position: absolute;
            inset: -2px;
            border-radius: 50%;
            background: var(--sl-grad-1);
            z-index: -1;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .member-item:hover .member-avatar::after {
            opacity: 0.2;
        }

        .member-details {
            flex: 1;
            min-width: 0;
        }

        .member-details h4 {
            font-size: 17px;
            font-weight: 700;
            color: var(--sl-neutral-900);
            margin-bottom: 6px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .member-details p {
            font-size: 14px;
            color: var(--sl-neutral-600);
            margin-bottom: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .member-details p:last-child {
            margin-bottom: 0;
        }
        
        .member-status {
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            text-transform: capitalize;
        }
        
        .member-status.active {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success);
        }
        
        .member-status.expired {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger);
        }
        
        .member-status.expiring {
            background: rgba(245, 158, 11, 0.1);
            color: var(--warning);
        }

        .member-stats {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 18px;
            font-weight: 700;
            color: var(--sl-brand);
        }

        .stat-label {
            font-size: 12px;
            color: var(--sl-neutral-500);
        }

        .member-actions {
            display: flex;
            gap: 8px;
        }

        .btn-icon {
            width: 36px;
            height: 36px;
            border: none;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-icon.edit {
            background: var(--sl-neutral-200);
            color: var(--sl-neutral-600);
        }

        .btn-icon.edit:hover {
            background: var(--sl-brand);
            color: white;
        }

        .btn-icon.delete {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger);
        }

        .btn-icon.delete:hover {
            background: var(--danger);
            color: white;
        }

        .tabs {
            display: flex;
            border-bottom: 1px solid var(--sl-neutral-200);
            margin-bottom: 24px;
        }

        .tab {
            padding: 12px 24px;
            background: none;
            border: none;
            font-size: 14px;
            font-weight: 600;
            color: var(--sl-neutral-500);
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.2s ease;
        }

        .tab.active {
            color: var(--sl-brand);
            border-bottom-color: var(--sl-brand);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .subscription-card {
            background: var(--sl-neutral-50);
            border: 1px solid var(--sl-neutral-200);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 16px;
        }

        .subscription-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .subscription-status {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .subscription-status.active {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success);
        }

        .subscription-status.expired {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger);
        }

        .subscription-status.expiring {
            background: rgba(245, 158, 11, 0.1);
            color: var(--warning);
        }

        .payment-history {
            max-height: 300px;
            overflow-y: auto;
        }

        .payment-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid var(--sl-neutral-200);
        }

        .payment-item:last-child {
            border-bottom: none;
        }

        .payment-amount {
            font-weight: 600;
            color: var(--success);
        }

        .mobile-menu-toggle {
            display: none;
            background: none;
            border: none;
            font-size: 24px;
            color: var(--sl-neutral-600);
            cursor: pointer;
            padding: 8px;
            border-radius: 8px;
            transition: all 0.2s ease;
            position: relative;
        }
        
        .mobile-menu-toggle:hover {
            background: var(--sl-neutral-100);
            color: var(--sl-brand);
        }
        
        .mobile-menu-toggle:active {
            transform: scale(0.95);
        }
        
        /* Hamburger animation */
        .mobile-menu-toggle .fa-bars,
        .mobile-menu-toggle .fa-times {
            transition: opacity 0.2s ease;
        }
        
        .mobile-menu-toggle.active .fa-bars {
            display: none;
        }
        
        .mobile-menu-toggle.active::before {
            content: "\f00d";
            font-family: "Font Awesome 6 Free";
            font-weight: 900;
        }

        @media (max-width: 768px) {
            .mobile-menu-toggle {
                display: flex;
                align-items: center;
                justify-content: center;
            }
            
            .header-title {
                font-size: 18px;
                margin-left: 8px;
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .modal-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--sl-neutral-900);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 20px;
            color: var(--sl-neutral-500);
            cursor: pointer;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            transition: all 0.2s ease;
            position: absolute;
            top: 16px;
            right: 16px;
        }
        
        .modal-close:hover {
            background: var(--sl-neutral-100);
            color: var(--sl-neutral-700);
        }
        
        .modal-close:focus {
            outline: 2px solid var(--sl-brand);
            outline-offset: 2px;
            background: var(--sl-neutral-100);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: var(--sl-neutral-700);
            margin-bottom: 8px;
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--sl-neutral-300);
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
            transition: all 0.2s ease;
            background: var(--sl-neutral-0);
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--sl-brand);
            box-shadow: 0 0 0 3px rgba(0, 119, 255, 0.1);
        }
        
        .form-input.error, .form-select.error, .form-textarea.error {
            border-color: var(--danger);
            box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1);
        }
        
        .form-input.success, .form-select.success, .form-textarea.success {
            border-color: var(--success);
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
        }
        
        .field-error {
            color: var(--danger);
            font-size: 12px;
            margin-top: 4px;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .field-success {
            color: var(--success);
            font-size: 12px;
            margin-top: 4px;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .form-group {
            position: relative;
        }
        
        .form-label.required::after {
            content: ' *';
            color: var(--danger);
        }

        .form-textarea {
            resize: vertical;
            min-height: 100px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.2s ease;
        }

        .btn-primary {
            background: var(--sl-brand);
            color: white;
        }

        .btn-primary:hover {
            background: var(--sl-brand-700);
        }

        .btn-secondary {
            background: var(--sl-neutral-200);
            color: var(--sl-neutral-700);
        }

        .btn-secondary:hover {
            background: var(--sl-neutral-300);
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .content-sections {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            body {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                position: fixed;
                top: 0;
                left: 0;
                width: 280px;
                height: 100vh;
                transform: translateX(-100%);
                transition: transform 0.3s ease;
                z-index: 200;
                box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
            }
            
            .sidebar.open {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
                width: 100%;
            }
            
            .dashboard-content {
                padding: 16px;
            }
            
            .metrics-grid {
                grid-template-columns: 1fr;
            }
            
            /* Mobile overlay */
            .mobile-overlay {
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.5);
                z-index: 150;
                display: none;
            }
            
            .mobile-overlay.active {
                display: block;
            }
            
            /* Improve mobile header */
            .header {
                padding: 12px 16px;
            }
            
            .header-title {
                font-size: 18px;
            }
            
            /* Better mobile form layouts */
            .form-group {
                margin-bottom: 16px;
            }
            
            .member-search {
                flex-direction: column;
                gap: 12px;
            }
            
            .search-input,
            .filter-select {
                width: 100%;
                min-width: unset;
            }
            
            /* Improve mobile modals */
            .modal-content {
                width: 95%;
                max-width: none;
                margin: 10px;
                max-height: 95vh;
            }
            
            /* Better mobile member cards */
            .member-item {
                padding: 12px;
                gap: 12px;
            }
            
            .member-stats {
                flex-direction: column;
                gap: 8px;
                align-items: flex-end;
            }
            
            .stat-item {
                text-align: right;
            }
        }

        /* Animation Classes */
        .fade-in {
            opacity: 0;
            transform: translateY(20px);
        }

        .slide-in-left {
            opacity: 0;
            transform: translateX(-30px);
        }

        .scale-in {
            opacity: 0;
            transform: scale(0.9);
        }
        
        /* Loading States */
        .loading {
            position: relative;
            pointer-events: none;
        }
        
        .loading::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: inherit;
            z-index: 10;
        }
        
        .loading::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 20px;
            height: 20px;
            margin: -10px 0 0 -10px;
            border: 2px solid var(--sl-neutral-300);
            border-radius: 50%;
            border-top-color: var(--sl-brand);
            animation: spin 1s linear infinite;
            z-index: 11;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Skeleton Loading */
        .skeleton {
            background: linear-gradient(90deg, var(--sl-neutral-200) 25%, var(--sl-neutral-100) 50%, var(--sl-neutral-200) 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }
        
        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
        
        /* Improved visual consistency */
        .action-btn:focus,
        .nav-link:focus,
        .btn:focus {
            outline: 2px solid var(--sl-brand);
            outline-offset: 2px;
        }
        
        /* Consistent border radius */
        .metric-card,
        .schedule-section,
        .content-section,
        .notifications-section,
        .quick-actions {
            border-radius: 16px;
        }
        
        /* Improved spacing consistency */
        .section-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--sl-neutral-900);
            margin-bottom: 20px;
            line-height: 1.2;
        }
        
        /* Better visual hierarchy */
        .dashboard-content h1,
        .dashboard-content h2,
        .dashboard-content h3 {
            color: var(--sl-neutral-900);
            font-weight: 700;
        }
        
        .dashboard-content h1 {
            font-size: 28px;
            line-height: 1.2;
        }
        
        .dashboard-content h2 {
            font-size: 20px;
            line-height: 1.3;
        }
        
        .dashboard-content h3 {
            font-size: 18px;
            line-height: 1.4;
        }
        
        /* Enhanced shadows for better depth */
        .metric-card:hover,
        .content-section:hover {
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }
        
        /* Improved button states */
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            pointer-events: none;
        }
        
        .btn:active {
            transform: translateY(1px);
        }
        
        /* Better loading button states */
        .btn.loading {
            position: relative;
            color: transparent;
        }
        
        .btn.loading::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 16px;
            height: 16px;
            margin: -8px 0 0 -8px;
            border: 2px solid currentColor;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 0.8s linear infinite;
        }
    </style>
</head>
<body>
    <!-- Sidebar Navigation -->
    <aside class="sidebar" id="sidebar">
        <div class="logo-section">
            <svg class="logo" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" role="img" aria-label="StudioLoop logo" fill="none">
                <g stroke="currentColor" stroke-width="22" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M128 84 Q 88 120 80 166" />
                    <path d="M128 84 Q 168 120 176 166" />
                    <path d="M80 166 Q 128 208 176 166" />
                </g>
                <g fill="currentColor">
                    <circle cx="128" cy="56" r="24"/>
                    <circle cx="68" cy="188" r="24"/>
                    <circle cx="188" cy="188" r="24"/>
                </g>
            </svg>
            <div class="logo-text">StudioLoop</div>
        </div>
        
        <nav>
            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="trainer-dashboard.html" class="nav-link active">
                        <i class="fas fa-chart-line"></i>
                        Dashboard
                    </a>
                </li>
                <li class="nav-item">
                    <a href="trainer-schedule.html" class="nav-link">
                        <i class="fas fa-calendar-alt"></i>
                        Schedule
                    </a>
                </li>
                <li class="nav-item">
                    <a href="trainer-dashboard.html#students" class="nav-link">
                        <i class="fas fa-users"></i>
                        Students
                    </a>
                </li>
                <li class="nav-item">
                    <a href="trainer-analytics.html" class="nav-link">
                        <i class="fas fa-chart-bar"></i>
                        Analytics
                    </a>
                </li>
                <li class="nav-item">
                    <a href="trainer-earnings.html" class="nav-link">
                        <i class="fas fa-dollar-sign"></i>
                        Earnings
                    </a>
                </li>
                <li class="nav-item">
                    <a href="trainer-equipment.html" class="nav-link">
                        <i class="fas fa-dumbbell"></i>
                        Equipment
                    </a>
                </li>
                <li class="nav-item">
                    <a href="trainer-communications.html" class="nav-link">
                        <i class="fab fa-whatsapp"></i>
                        Communications
                    </a>
                </li>
                <li class="nav-item">
                    <a href="trainer-settings.html" class="nav-link">
                        <i class="fas fa-cog"></i>
                        Settings
                    </a>
                </li>
            </ul>
        </nav>
    </aside>

    <!-- Mobile Overlay -->
    <div class="mobile-overlay" id="mobileOverlay"></div>
    
    <!-- Main Content -->
    <main class="main-content">
        <!-- Header -->
        <header class="header">
            <div style="display: flex; align-items: center; gap: 16px;">
                <button class="mobile-menu-toggle" id="mobileMenuToggle">
                    <i class="fas fa-bars"></i>
                </button>
                <h1 class="header-title">Trainer Dashboard</h1>
            </div>
            <div class="header-actions">
                <button class="notification-bell" id="notificationBtn">
                    <i class="fas fa-bell"></i>
                    <span class="notification-badge">3</span>
                </button>
                <div class="user-menu" id="userMenu">
                    <div class="user-avatar">JD</div>
                    <div class="user-info">
                        <h4>John Doe</h4>
                        <p>Fitness Trainer</p>
                    </div>
                    <i class="fas fa-chevron-down"></i>
                </div>
            </div>
        </header>

        <!-- Dashboard Content -->
        <div class="dashboard-content">
            <!-- Load Shedding Alert -->
            <div class="load-shedding-alert" id="loadSheddingAlert">
                <i class="fas fa-bolt icon"></i>
                <div class="content">
                    <h4>Load Shedding Alert - Stage 2 Active</h4>
                    <p>Scheduled outage: Today 16:00 - 18:30 • 2 classes may be affected • <strong>Backup power available</strong></p>
                </div>
                <button class="dismiss-btn" onclick="dismissLoadSheddingAlert()">
                    <i class="fas fa-times"></i> Dismiss
                </button>
            </div>

            <!-- Dashboard Grid -->
            <div class="dashboard-grid">
                <!-- Metrics Section -->
                <div class="metrics-section">
                    <div class="metrics-grid">
                        <div class="metric-card fade-in">
                            <div class="metric-header">
                                <div class="metric-icon earnings">
                                    <i class="fas fa-money-bill-wave"></i>
                                </div>
                            </div>
                            <div class="metric-value">R 12,450</div>
                            <div class="metric-label">Monthly Earnings</div>
                            <div class="metric-change positive">
                                <i class="fas fa-arrow-up"></i>
                                +15.3% from last month
                            </div>
                        </div>

                        <div class="metric-card fade-in">
                            <div class="metric-header">
                                <div class="metric-icon classes">
                                    <i class="fas fa-dumbbell"></i>
                                </div>
                            </div>
                            <div class="metric-value">28</div>
                            <div class="metric-label">Classes This Week</div>
                            <div class="metric-change positive">
                                <i class="fas fa-arrow-up"></i>
                                +12% from last week
                            </div>
                        </div>

                        <div class="metric-card fade-in">
                            <div class="metric-header">
                                <div class="metric-icon students">
                                    <i class="fas fa-users"></i>
                                </div>
                            </div>
                            <div class="metric-value">156</div>
                            <div class="metric-label">Active Students</div>
                            <div class="metric-change positive">
                                <i class="fas fa-arrow-up"></i>
                                +8 new this month
                            </div>
                        </div>

                        <div class="metric-card fade-in">
                            <div class="metric-header">
                                <div class="metric-icon attendance">
                                    <i class="fas fa-percentage"></i>
                                </div>
                            </div>
                            <div class="metric-value">89%</div>
                            <div class="metric-label">Attendance Rate</div>
                            <div class="metric-change negative">
                                <i class="fas fa-arrow-down"></i>
                                -2% from last month
                            </div>
                        </div>
                    </div>

                    <!-- Today's Schedule -->
                    <div class="schedule-section">
                        <div class="schedule-header">
                            <h2 class="section-title">Today's Schedule</h2>
                            <div class="schedule-date">Wednesday, August 20, 2025</div>
                        </div>
                        <div class="class-list">
                            <div class="class-card">
                                <div class="class-time">09:00</div>
                                <div class="class-info">
                                    <h4>HIIT Training</h4>
                                    <div class="class-details">
                                        <span><i class="fas fa-users"></i> 12/15 spots</span>
                                        <span><i class="fas fa-clock"></i> 45 min</span>
                                    </div>
                                </div>
                                <div class="class-status confirmed">Confirmed</div>
                            </div>
                            <div class="class-card">
                                <div class="class-time">11:30</div>
                                <div class="class-info">
                                    <h4>Strength Training</h4>
                                    <div class="class-details">
                                        <span><i class="fas fa-users"></i> 8/12 spots</span>
                                        <span><i class="fas fa-clock"></i> 60 min</span>
                                    </div>
                                </div>
                                <div class="class-status pending">Pending</div>
                            </div>
                            <div class="class-card">
                                <div class="class-time">17:00</div>
                                <div class="class-info">
                                    <h4>Yoga Flow</h4>
                                    <div class="class-details">
                                        <span><i class="fas fa-users"></i> 15/15 spots</span>
                                        <span><i class="fas fa-clock"></i> 50 min</span>
                                    </div>
                                </div>
                                <div class="class-status confirmed">Confirmed</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="quick-actions">
                    <h2 class="section-title">Quick Actions</h2>
                    <div class="action-grid">
                        <button class="action-btn" id="createClassBtn">
                            <i class="fas fa-plus"></i>
                            Create New Class
                        </button>
                        <button class="action-btn" id="manageStudentsBtn">
                            <i class="fas fa-user-edit"></i>
                            Manage Students
                        </button>
                        <button class="action-btn" id="viewEarningsBtn">
                            <i class="fas fa-chart-line"></i>
                            View Earnings Report
                        </button>
                        <button class="action-btn" id="whatsappBtn">
                            <i class="fab fa-whatsapp"></i>
                            Send WhatsApp Update
                        </button>
                        <button class="action-btn" id="equipmentBtn">
                            <i class="fas fa-tools"></i>
                            Check Equipment
                        </button>
                        <button class="action-btn" id="settingsBtn">
                            <i class="fas fa-cog"></i>
                            Update Preferences
                        </button>
                    </div>
                </div>
            </div>

            <!-- Content Sections -->
            <div class="content-sections">
                <!-- Recent Students -->
                <div class="content-section">
                    <h2 class="section-title">Recent Students</h2>
                    <div class="student-list">
                        <div class="student-card">
                            <div class="student-avatar">AM</div>
                            <div class="student-info">
                                <h4>Aisha Mthembu</h4>
                                <p>HIIT Training • Premium Member</p>
                            </div>
                            <div class="student-stats">
                                <div class="classes-attended">24 classes</div>
                                <div class="last-visit">Last: Yesterday</div>
                            </div>
                        </div>
                        <div class="student-card">
                            <div class="student-avatar">TN</div>
                            <div class="student-info">
                                <h4>Thabo Nkomo</h4>
                                <p>Strength Training • Standard Member</p>
                            </div>
                            <div class="student-stats">
                                <div class="classes-attended">18 classes</div>
                                <div class="last-visit">Last: 2 days ago</div>
                            </div>
                        </div>
                        <div class="student-card">
                            <div class="student-avatar">LK</div>
                            <div class="student-info">
                                <h4>Lerato Kgomo</h4>
                                <p>Yoga Flow • Premium Member</p>
                            </div>
                            <div class="student-stats">
                                <div class="classes-attended">31 classes</div>
                                <div class="last-visit">Last: Today</div>
                            </div>
                        </div>
                        <div class="student-card">
                            <div class="student-avatar">SJ</div>
                            <div class="student-info">
                                <h4>Sipho Jali</h4>
                                <p>CrossFit • Standard Member</p>
                            </div>
                            <div class="student-stats">
                                <div class="classes-attended">12 classes</div>
                                <div class="last-visit">Last: Monday</div>
                            </div>
                        </div>
                        <div class="student-card">
                            <div class="student-avatar">NM</div>
                            <div class="student-info">
                                <h4>Nomsa Mhlanga</h4>
                                <p>Pilates • Premium Member</p>
                            </div>
                            <div class="student-stats">
                                <div class="classes-attended">27 classes</div>
                                <div class="last-visit">Last: Tuesday</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Analytics Chart -->
                <div class="content-section analytics-section">
                    <div class="chart-header">
                        <div>
                            <h2 class="chart-title">
                                <i class="fas fa-chart-line" style="color: var(--sl-brand);"></i>
                                Performance Analytics
                            </h2>
                            <p class="chart-subtitle">Track your training metrics and student engagement</p>
                        </div>
                        <div class="chart-controls">
                            <div class="chart-period-group">
                                <button class="btn chart-period active" data-period="week">7 Days</button>
                                <button class="btn chart-period" data-period="month">30 Days</button>
                                <button class="btn chart-period" data-period="year">12 Months</button>
                            </div>
                            <button class="btn" onclick="refreshAnalytics()" title="Refresh data">
                                <i class="fas fa-sync-alt"></i>
                            </button>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="performanceChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Notifications Section -->
            <div class="notifications-section">
                <h2 class="section-title">Recent Notifications</h2>
                <div class="notifications-list">
                    <div class="notification-item booking">
                        <div class="notification-icon" style="background: var(--success);">
                            <i class="fas fa-calendar-check"></i>
                        </div>
                        <div class="notification-content">
                            <h4>New Class Booking</h4>
                            <p>Zanele Dlamini booked "HIIT Training" for tomorrow at 9:00 AM</p>
                        </div>
                        <div class="notification-time">5 mins ago</div>
                    </div>
                    <div class="notification-item cancellation">
                        <div class="notification-icon" style="background: var(--danger);">
                            <i class="fas fa-calendar-times"></i>
                        </div>
                        <div class="notification-content">
                            <h4>Class Cancellation</h4>
                            <p>Michael Johnson cancelled "Strength Training" scheduled for today at 11:30 AM</p>
                        </div>
                        <div class="notification-time">12 mins ago</div>
                    </div>
                    <div class="notification-item payment">
                        <div class="notification-icon" style="background: var(--sl-brand);">
                            <i class="fas fa-credit-card"></i>
                        </div>
                        <div class="notification-content">
                            <h4>Payment Received</h4>
                            <p>Monthly payment of R450 received from Priya Sharma</p>
                        </div>
                        <div class="notification-time">1 hour ago</div>
                    </div>
                    <div class="notification-item system">
                        <div class="notification-icon" style="background: var(--warning);">
                            <i class="fas fa-bolt"></i>
                        </div>
                        <div class="notification-content">
                            <h4>Load Shedding Update</h4>
                            <p>Stage 2 load shedding scheduled for 16:00-18:30 today. 2 classes may be affected.</p>
                        </div>
                        <div class="notification-time">2 hours ago</div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Create Class Modal -->
    <div class="modal" id="createClassModal" role="dialog" aria-labelledby="createClassTitle" aria-modal="true">
        <div class="modal-content" tabindex="-1">
            <div class="modal-header">
                <h3 class="modal-title" id="createClassTitle">Create New Class</h3>
                <button class="modal-close" id="closeCreateModal" aria-label="Close create class dialog">
                    <i class="fas fa-times" aria-hidden="true"></i>
                </button>
            </div>
            <form id="createClassForm">
                <div class="form-group">
                    <label class="form-label required" for="className">Class Name</label>
                    <input type="text" class="form-input" id="className" placeholder="e.g., HIIT Training" required aria-describedby="className-help">
                    <small id="className-help" style="color: var(--sl-neutral-500); font-size: 12px;">Choose a descriptive name for your class</small>
                </div>
                <div class="form-group">
                    <label class="form-label required" for="classDate">Date</label>
                    <input type="date" class="form-input" id="classDate" required aria-describedby="classDate-help">
                    <small id="classDate-help" style="color: var(--sl-neutral-500); font-size: 12px;">Select the date for this class</small>
                </div>
                <div class="form-group">
                    <label class="form-label required" for="classTime">Time</label>
                    <input type="time" class="form-input" id="classTime" required aria-describedby="classTime-help">
                    <small id="classTime-help" style="color: var(--sl-neutral-500); font-size: 12px;">What time does the class start?</small>
                </div>
                <div class="form-group">
                    <label class="form-label" for="classDuration">Duration (minutes)</label>
                    <select class="form-select" id="classDuration" aria-describedby="classDuration-help">
                        <option value="30">30 minutes</option>
                        <option value="45" selected>45 minutes</option>
                        <option value="60">60 minutes</option>
                        <option value="90">90 minutes</option>
                    </select>
                    <small id="classDuration-help" style="color: var(--sl-neutral-500); font-size: 12px;">How long will the class last?</small>
                </div>
                <div class="form-group">
                    <label class="form-label required" for="classCapacity">Max Capacity</label>
                    <input type="number" class="form-input" id="classCapacity" placeholder="15" min="1" max="50" required aria-describedby="classCapacity-help">
                    <small id="classCapacity-help" style="color: var(--sl-neutral-500); font-size: 12px;">Maximum number of participants (1-50)</small>
                </div>
                <div class="form-group">
                    <label class="form-label required" for="classPrice">Price (ZAR)</label>
                    <input type="number" class="form-input" id="classPrice" placeholder="150" min="0" step="10" required aria-describedby="classPrice-help">
                    <small id="classPrice-help" style="color: var(--sl-neutral-500); font-size: 12px;">Cost per person for this class</small>
                </div>
                <div class="form-group">
                    <label class="form-label" for="classDescription">Description</label>
                    <textarea class="form-textarea" id="classDescription" placeholder="Class description..."></textarea>
                </div>
                <div style="display: flex; gap: 12px; justify-content: flex-end; margin-top: 24px;">
                    <button type="button" class="btn btn-secondary" id="cancelCreateClass">Cancel</button>
                    <button type="submit" class="btn btn-primary">Create Class</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Member Management Modal -->
    <div class="modal" id="memberManagementModal" role="dialog" aria-labelledby="memberManagementTitle" aria-modal="true">
        <div class="modal-content large" tabindex="-1">
            <div class="modal-header">
                <h3 class="modal-title" id="memberManagementTitle">Member Management</h3>
                <button class="modal-close" id="closeMemberModal" aria-label="Close member management dialog">
                    <i class="fas fa-times" aria-hidden="true"></i>
                </button>
            </div>
            
            <!-- Member Stats -->
            <div class="member-stats">
                <div class="member-stat">
                    <div class="member-stat-value" id="totalMembers">156</div>
                    <div class="member-stat-label">Total Members</div>
                </div>
                <div class="member-stat">
                    <div class="member-stat-value" id="activeMembers">142</div>
                    <div class="member-stat-label">Active</div>
                </div>
                <div class="member-stat">
                    <div class="member-stat-value" id="expiringMembers">8</div>
                    <div class="member-stat-label">Expiring Soon</div>
                </div>
                <div class="member-stat">
                    <div class="member-stat-value" id="expiredMembers">6</div>
                    <div class="member-stat-label">Expired</div>
                </div>
            </div>
            
            <div class="member-search">
                <div class="search-wrapper">
                    <input type="text" class="form-input search-input" id="memberSearch" placeholder="Search members by name, email, or phone...">
                </div>
                <select class="form-select filter-select" id="memberFilter">
                    <option value="all">All Members</option>
                    <option value="active">Active Members</option>
                    <option value="expired">Expired Memberships</option>
                    <option value="expiring">Expiring Soon</option>
                </select>
                <div class="member-search-actions">
                    <button class="btn btn-secondary" id="exportMembersBtn" title="Export member data">
                        <i class="fas fa-download"></i>
                        Export
                    </button>
                    <button class="btn btn-primary" id="addMemberBtn">
                        <i class="fas fa-plus"></i>
                        Add Member
                    </button>
                </div>
            </div>
            
            <div class="member-grid" id="memberGrid">
                <!-- Members will be populated here by JavaScript -->
            </div>
            
            <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 20px;">
                <span id="memberCount">Showing 0 members</span>
                <button class="btn btn-secondary" id="closeMemberManagement">Close</button>
            </div>
        </div>
    </div>

    <!-- Add/Edit Member Modal -->
    <div class="modal" id="addEditMemberModal" role="dialog" aria-labelledby="memberModalTitle" aria-modal="true">
        <div class="modal-content" tabindex="-1">
            <div class="modal-header">
                <h3 class="modal-title" id="memberModalTitle">Add New Member</h3>
                <button class="modal-close" id="closeAddEditModal" aria-label="Close add/edit member dialog">
                    <i class="fas fa-times" aria-hidden="true"></i>
                </button>
            </div>
            
            <form id="memberForm">
                <div class="form-group">
                    <label class="form-label required" for="memberName">Full Name</label>
                    <input type="text" class="form-input" id="memberName" placeholder="John Doe" required aria-describedby="memberName-help">
                    <small id="memberName-help" style="color: var(--sl-neutral-500); font-size: 12px;">Enter the member's full legal name</small>
                </div>
                <div class="form-group">
                    <label class="form-label required" for="memberEmail">Email</label>
                    <input type="email" class="form-input" id="memberEmail" placeholder="john@example.com" required aria-describedby="memberEmail-help">
                    <small id="memberEmail-help" style="color: var(--sl-neutral-500); font-size: 12px;">This will be used for communication and login</small>
                </div>
                <div class="form-group">
                    <label class="form-label required" for="memberPhone">Phone Number</label>
                    <input type="tel" class="form-input" id="memberPhone" placeholder="+27 XX XXX XXXX" required aria-describedby="memberPhone-help">
                    <small id="memberPhone-help" style="color: var(--sl-neutral-500); font-size: 12px;">Include country code (e.g., +27 for South Africa)</small>
                </div>
                <div class="form-group">
                    <label class="form-label required" for="memberType">Membership Type</label>
                    <select class="form-select" id="memberType" required aria-describedby="memberType-help">
                        <option value="">Select membership type</option>
                        <option value="basic">Basic - R300/month (2 classes per week)</option>
                        <option value="standard">Standard - R450/month (4 classes per week)</option>
                        <option value="premium">Premium - R650/month (Unlimited classes)</option>
                    </select>
                    <small id="memberType-help" style="color: var(--sl-neutral-500); font-size: 12px;">Choose the plan that best fits their needs</small>
                </div>
                <div class="form-group">
                    <label class="form-label required" for="memberStartDate">Start Date</label>
                    <input type="date" class="form-input" id="memberStartDate" required aria-describedby="memberStartDate-help">
                    <small id="memberStartDate-help" style="color: var(--sl-neutral-500); font-size: 12px;">When did their membership begin?</small>
                </div>
                <div class="form-group">
                    <label class="form-label" for="memberNotes">Notes</label>
                    <textarea class="form-textarea" id="memberNotes" placeholder="Any additional notes about the member..."></textarea>
                </div>
                <div style="display: flex; gap: 12px; justify-content: flex-end; margin-top: 24px;">
                    <button type="button" class="btn btn-secondary" id="cancelMemberForm">Cancel</button>
                    <button type="submit" class="btn btn-primary" id="saveMemberBtn">Save Member</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Member Details Modal -->
    <div class="modal" id="memberDetailsModal" role="dialog" aria-labelledby="memberDetailsTitle" aria-modal="true">
        <div class="modal-content large" tabindex="-1">
            <div class="modal-header">
                <h3 class="modal-title" id="memberDetailsTitle">Member Details</h3>
                <button class="modal-close" id="closeMemberDetailsModal" aria-label="Close member details dialog">
                    <i class="fas fa-times" aria-hidden="true"></i>
                </button>
            </div>
            
            <div class="tabs">
                <button class="tab active" data-tab="overview">Overview</button>
                <button class="tab" data-tab="subscription">Subscription</button>
                <button class="tab" data-tab="activity">Activity</button>
                <button class="tab" data-tab="payments">Payments</button>
            </div>
            
            <div class="tab-content active" id="overview-tab">
                <div id="memberOverview">
                    <!-- Member overview content will be populated here -->
                </div>
            </div>
            
            <div class="tab-content" id="subscription-tab">
                <div id="memberSubscription">
                    <!-- Subscription content will be populated here -->
                </div>
            </div>
            
            <div class="tab-content" id="activity-tab">
                <div id="memberActivity">
                    <!-- Activity content will be populated here -->
                </div>
            </div>
            
            <div class="tab-content" id="payments-tab">
                <div id="memberPayments">
                    <!-- Payment history will be populated here -->
                </div>
            </div>
            
            <div style="display: flex; justify-content: flex-end; margin-top: 24px;">
                <button class="btn btn-secondary" id="closeMemberDetails">Close</button>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
        // Optimized GSAP animations with performance improvements
        function initializeAnimations() {
            // Set initial states
            gsap.set('.fade-in', { opacity: 0, y: 20 });
            gsap.set('.slide-in-left', { opacity: 0, x: -30 });
            gsap.set('.scale-in', { opacity: 0, scale: 0.9 });
            
            // Create main timeline
            const mainTimeline = gsap.timeline({ paused: true });
            
            mainTimeline
                .to('.fade-in', {
                    opacity: 1,
                    y: 0,
                    duration: 0.6,
                    stagger: {
                        amount: 0.3,
                        from: 'start'
                    },
                    ease: 'power2.out'
                })
                .to('.slide-in-left', {
                    opacity: 1,
                    x: 0,
                    duration: 0.6,
                    stagger: 0.1,
                    ease: 'power2.out'
                }, '-=0.4')
                .to('.scale-in', {
                    opacity: 1,
                    scale: 1,
                    duration: 0.6,
                    stagger: 0.08,
                    ease: 'back.out(1.2)'
                }, '-=0.3');
                
            return mainTimeline;
        }
        
        // Page load animations with performance monitoring
        window.addEventListener('load', () => {
            const startTime = performance.now();
            
            // Small delay to ensure everything is ready
            requestAnimationFrame(() => {
                const timeline = initializeAnimations();
                timeline.play();
                
                const endTime = performance.now();
                console.log(`Animation initialization took ${endTime - startTime} milliseconds`);
                
                // Show welcome notification after animations
                timeline.add(() => {
                    setTimeout(() => {
                        showNotification('Welcome back to your trainer dashboard!', 'success', 3000);
                    }, 500);
                });
            });
        });

        // Enhanced navigation functionality with debouncing
        let navigationTimeout;
        
        function handleNavigation(link, section) {
            // Debounce navigation to prevent rapid clicks
            clearTimeout(navigationTimeout);
            
            navigationTimeout = setTimeout(() => {
                // Remove active class from all links
                document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                
                // Add active class to clicked link
                link.classList.add('active');
                
                // Update page title
                const sectionName = link.textContent.trim();
                document.title = `${sectionName} - StudioLoop Trainer Dashboard`;
                
                // Show loading state
                showLoading('.dashboard-content');
                
                // Animate transition
                gsap.to('.dashboard-content', {
                    opacity: 0.3,
                    y: 10,
                    duration: 0.2,
                    ease: 'power2.out',
                    onComplete: () => {
                        // Simulate content loading
                        setTimeout(() => {
                            hideLoading('.dashboard-content');
                            
                            // In a real app, you would switch content here
                            gsap.to('.dashboard-content', {
                                opacity: 1,
                                y: 0,
                                duration: 0.3,
                                ease: 'power2.out'
                            });
                            
                            // Show section-specific notification
                            if (section !== 'dashboard') {
                                showNotification(`Switched to ${sectionName}`, 'info', 2000);
                            }
                        }, 500);
                    }
                });
            }, 150);
        }
        
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const section = link.dataset.section || 'dashboard';
                handleNavigation(link, section);
            });
        });

        // Modal functionality
        const createClassModal = document.getElementById('createClassModal');
        const createClassBtn = document.getElementById('createClassBtn');
        const closeCreateModal = document.getElementById('closeCreateModal');
        const cancelCreateClass = document.getElementById('cancelCreateClass');

        function openModal(modal) {
            modal.classList.add('active');
            const modalContent = modal.querySelector('.modal-content');
            
            // Set initial state
            gsap.set(modalContent, { scale: 0.9, opacity: 0 });
            
            // Animate in
            gsap.to(modalContent, {
                scale: 1,
                opacity: 1,
                duration: 0.3,
                ease: 'back.out(1.7)',
                onComplete: () => {
                    // Focus management for accessibility
                    focusModal(modal);
                }
            });
            
            // Trap focus within modal
            trapFocus(modal);
            
            // Store previously focused element
            modal._previouslyFocused = document.activeElement;
            
            // Prevent body scroll
            document.body.style.overflow = 'hidden';
        }

        function closeModal(modal) {
            gsap.to(modal.querySelector('.modal-content'), {
                scale: 0.9,
                opacity: 0,
                duration: 0.2,
                onComplete: () => {
                    modal.classList.remove('active');
                    
                    // Restore focus to previously focused element
                    if (modal._previouslyFocused) {
                        modal._previouslyFocused.focus();
                    }
                    
                    // Restore body scroll
                    document.body.style.overflow = '';
                    
                    // Clear form data if it's a form modal
                    clearModalForm(modal);
                }
            });
        }
        
        function focusModal(modal) {
            const firstFocusable = modal.querySelector('input, button, select, textarea, [tabindex]:not([tabindex="-1"])');
            if (firstFocusable) {
                firstFocusable.focus();
            } else {
                modal.querySelector('.modal-content').focus();
            }
        }
        
        function trapFocus(modal) {
            const focusableElements = modal.querySelectorAll(
                'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'
            );
            const firstFocusable = focusableElements[0];
            const lastFocusable = focusableElements[focusableElements.length - 1];
            
            modal.addEventListener('keydown', function handleTabKey(e) {
                if (e.key === 'Tab') {
                    if (e.shiftKey) {
                        if (document.activeElement === firstFocusable) {
                            lastFocusable.focus();
                            e.preventDefault();
                        }
                    } else {
                        if (document.activeElement === lastFocusable) {
                            firstFocusable.focus();
                            e.preventDefault();
                        }
                    }
                }
            });
        }
        
        function clearModalForm(modal) {
            const form = modal.querySelector('form');
            if (form && form.id !== 'memberForm') { // Don't clear member form as it might be in edit mode
                form.reset();
                
                // Clear any validation messages
                modal.querySelectorAll('.field-error').forEach(error => error.remove());
                modal.querySelectorAll('.form-input.error, .form-select.error').forEach(field => {
                    field.classList.remove('error');
                });
            }
        }

        createClassBtn.addEventListener('click', () => openModal(createClassModal));
        closeCreateModal.addEventListener('click', () => closeModal(createClassModal));
        cancelCreateClass.addEventListener('click', () => closeModal(createClassModal));

        // Close modal when clicking outside
        createClassModal.addEventListener('click', (e) => {
            if (e.target === createClassModal) {
                closeModal(createClassModal);
            }
        });

        // Enhanced create class form validation
        function validateCreateClassForm() {
            const className = document.getElementById('className').value.trim();
            const classDate = document.getElementById('classDate').value;
            const classTime = document.getElementById('classTime').value;
            const classCapacity = document.getElementById('classCapacity').value;
            const classPrice = document.getElementById('classPrice').value;
            
            let isValid = true;
            
            // Clear previous errors
            document.querySelectorAll('#createClassForm .field-error').forEach(error => error.remove());
            document.querySelectorAll('#createClassForm .form-input.error, #createClassForm .form-select.error').forEach(field => {
                field.classList.remove('error');
            });
            
            // Validate class name
            if (className.length < 3) {
                showFieldError('className', 'Class name must be at least 3 characters long');
                isValid = false;
            }
            
            // Validate date
            if (!classDate) {
                showFieldError('classDate', 'Please select a date');
                isValid = false;
            } else {
                const selectedDate = new Date(classDate);
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                if (selectedDate < today) {
                    showFieldError('classDate', 'Class date cannot be in the past');
                    isValid = false;
                }
            }
            
            // Validate time
            if (!classTime) {
                showFieldError('classTime', 'Please select a time');
                isValid = false;
            }
            
            // Validate capacity
            if (!classCapacity || classCapacity < 1 || classCapacity > 50) {
                showFieldError('classCapacity', 'Capacity must be between 1 and 50');
                isValid = false;
            }
            
            // Validate price
            if (!classPrice || classPrice < 0) {
                showFieldError('classPrice', 'Please enter a valid price');
                isValid = false;
            }
            
            return isValid;
        }
        
        function showFieldError(fieldId, message) {
            const field = document.getElementById(fieldId);
            field.classList.add('error');
            
            const errorDiv = document.createElement('div');
            errorDiv.className = 'field-error';
            errorDiv.innerHTML = `<i class="fas fa-exclamation-circle"></i> ${message}`;
            field.parentNode.appendChild(errorDiv);
        }
        
        // Enhanced form submission
        document.getElementById('createClassForm').addEventListener('submit', (e) => {
            e.preventDefault();
            
            if (!validateCreateClassForm()) {
                showNotification('Please correct the errors above', 'error');
                return;
            }
            
            const submitBtn = e.target.querySelector('button[type="submit"]');
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Creating...';
            submitBtn.disabled = true;
            
            // Animate form
            gsap.to(e.target, {
                opacity: 0.7,
                duration: 0.3,
                onComplete: () => {
                    setTimeout(() => {
                        // Show success message
                        showNotification('Class created successfully!', 'success');
                        closeModal(createClassModal);
                        e.target.reset();
                        gsap.set(e.target, { opacity: 1 });
                        submitBtn.innerHTML = originalText;
                        submitBtn.disabled = false;
                    }, 1000);
                }
            });
        });

        // Sample member data
        let members = [
            {
                id: 1,
                name: 'Aisha Mthembu',
                email: 'aisha.mthembu@email.com',
                phone: '+27 82 123 4567',
                membershipType: 'premium',
                startDate: '2024-01-15',
                status: 'active',
                classesAttended: 24,
                lastVisit: '2025-08-19',
                notes: 'Loves HIIT training sessions',
                payments: [
                    { date: '2025-08-01', amount: 650, method: 'Card', status: 'Paid' },
                    { date: '2025-07-01', amount: 650, method: 'EFT', status: 'Paid' },
                    { date: '2025-06-01', amount: 650, method: 'Card', status: 'Paid' }
                ]
            },
            {
                id: 2,
                name: 'Thabo Nkomo',
                email: 'thabo.nkomo@email.com',
                phone: '+27 83 456 7890',
                membershipType: 'standard',
                startDate: '2024-03-01',
                status: 'active',
                classesAttended: 18,
                lastVisit: '2025-08-18',
                notes: 'Focuses on strength training',
                payments: [
                    { date: '2025-08-01', amount: 450, method: 'Cash', status: 'Paid' },
                    { date: '2025-07-01', amount: 450, method: 'Cash', status: 'Paid' }
                ]
            },
            {
                id: 3,
                name: 'Lerato Kgomo',
                email: 'lerato.kgomo@email.com',
                phone: '+27 84 789 0123',
                membershipType: 'premium',
                startDate: '2023-12-01',
                status: 'active',
                classesAttended: 31,
                lastVisit: '2025-08-20',
                notes: 'Regular yoga participant',
                payments: [
                    { date: '2025-08-01', amount: 650, method: 'EFT', status: 'Paid' },
                    { date: '2025-07-01', amount: 650, method: 'EFT', status: 'Paid' }
                ]
            },
            {
                id: 4,
                name: 'Sipho Jali',
                email: 'sipho.jali@email.com',
                phone: '+27 85 012 3456',
                membershipType: 'basic',
                startDate: '2025-06-01',
                status: 'expiring',
                classesAttended: 12,
                lastVisit: '2025-08-19',
                notes: 'New to CrossFit',
                payments: [
                    { date: '2025-08-01', amount: 300, method: 'Card', status: 'Pending' },
                    { date: '2025-07-01', amount: 300, method: 'Card', status: 'Paid' }
                ]
            },
            {
                id: 5,
                name: 'Nomsa Mhlanga',
                email: 'nomsa.mhlanga@email.com',
                phone: '+27 86 234 5678',
                membershipType: 'premium',
                startDate: '2024-02-01',
                status: 'active',
                classesAttended: 27,
                lastVisit: '2025-08-19',
                notes: 'Pilates enthusiast',
                payments: [
                    { date: '2025-08-01', amount: 650, method: 'EFT', status: 'Paid' },
                    { date: '2025-07-01', amount: 650, method: 'EFT', status: 'Paid' }
                ]
            }
        ];

        let currentEditingMember = null;

        // Member management functionality
        async function openMemberManagement() {
            const modal = document.getElementById('memberManagementModal');
            openModal(modal);
            
            // Show loading state while "fetching" members
            showMemberLoading(true);
            
            // Simulate API call
            await new Promise(resolve => setTimeout(resolve, 600));
            
            renderMembers();
            showMemberLoading(false);
        }

        function renderMembers(filteredMembers = null) {
            const memberGrid = document.getElementById('memberGrid');
            const memberCount = document.getElementById('memberCount');
            const membersToShow = filteredMembers || members;
            
            memberGrid.innerHTML = '';
            
            if (membersToShow.length === 0) {
                memberCount.textContent = 'No members found';
                return;
            }
            
            membersToShow.forEach((member, index) => {
                const memberItem = document.createElement('div');
                memberItem.className = 'member-item';
                memberItem.setAttribute('tabindex', '0');
                memberItem.setAttribute('role', 'button');
                memberItem.setAttribute('aria-label', `Member: ${member.name}`);
                
                memberItem.innerHTML = `
                    <div class="member-avatar" aria-hidden="true">${member.name.split(' ').map(n => n[0]).join('')}</div>
                    <div class="member-details">
                        <h4>${escapeHtml(member.name)}</h4>
                        <p>${escapeHtml(member.email)}</p>
                        <p>${member.membershipType.charAt(0).toUpperCase() + member.membershipType.slice(1)} Member • 
                           <span class="member-status ${member.status}">${member.status.charAt(0).toUpperCase() + member.status.slice(1)}</span></p>
                    </div>
                    <div class="member-stats">
                        <div class="stat-item">
                            <div class="stat-value">${member.classesAttended}</div>
                            <div class="stat-label">Classes</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">${formatDate(member.lastVisit)}</div>
                            <div class="stat-label">Last Visit</div>
                        </div>
                    </div>
                    <div class="member-actions">
                        <button class="btn-icon edit" onclick="editMember(${member.id})" 
                                title="Edit ${escapeHtml(member.name)}" aria-label="Edit ${escapeHtml(member.name)}">
                            <i class="fas fa-edit" aria-hidden="true"></i>
                        </button>
                        <button class="btn-icon edit" onclick="viewMemberDetails(${member.id})" 
                                title="View ${escapeHtml(member.name)} details" aria-label="View ${escapeHtml(member.name)} details">
                            <i class="fas fa-eye" aria-hidden="true"></i>
                        </button>
                        <button class="btn-icon delete" onclick="deleteMember(${member.id})" 
                                title="Delete ${escapeHtml(member.name)}" aria-label="Delete ${escapeHtml(member.name)}">
                            <i class="fas fa-trash" aria-hidden="true"></i>
                        </button>
                    </div>
                `;
                
                // Add keyboard navigation
                memberItem.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        viewMemberDetails(member.id);
                    }
                });
                
                // Add entrance animation
                gsap.set(memberItem, { opacity: 0, y: 20 });
                gsap.to(memberItem, {
                    opacity: 1,
                    y: 0,
                    duration: 0.3,
                    delay: index * 0.05,
                    ease: 'power2.out'
                });
                
                memberGrid.appendChild(memberItem);
            });
            
            memberCount.textContent = `Showing ${membersToShow.length} member${membersToShow.length !== 1 ? 's' : ''}`;
        }
        
        function showMemberLoading(show) {
            const memberGrid = document.getElementById('memberGrid');
            if (show) {
                memberGrid.innerHTML = `
                    <div style="grid-column: 1 / -1; display: flex; align-items: center; justify-content: center; padding: 40px; color: var(--sl-neutral-500);">
                        <i class="fas fa-spinner fa-spin" style="font-size: 24px; margin-right: 12px;"></i>
                        Searching members...
                    </div>
                `;
            }
        }
        
        function showNoResultsMessage(searchTerm, filter) {
            const memberGrid = document.getElementById('memberGrid');
            let message = 'No members found';
            
            if (searchTerm && filter !== 'all') {
                message = `No ${filter} members found matching "${searchTerm}"`;
            } else if (searchTerm) {
                message = `No members found matching "${searchTerm}"`;
            } else if (filter !== 'all') {
                message = `No ${filter} members found`;
            }
            
            memberGrid.innerHTML = `
                <div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: var(--sl-neutral-500);">
                    <i class="fas fa-search" style="font-size: 48px; margin-bottom: 16px; opacity: 0.5;"></i>
                    <h4 style="margin-bottom: 8px; color: var(--sl-neutral-600);">${message}</h4>
                    <p style="margin-bottom: 16px;">Try adjusting your search or filter criteria</p>
                    <button onclick="document.getElementById('memberSearch').value=''; document.getElementById('memberFilter').value='all'; searchMembers();" 
                            class="btn btn-secondary">
                        <i class="fas fa-times"></i> Clear Search
                    </button>
                </div>
            `;
        }
        
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            const today = new Date();
            const diffTime = today - date;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            
            if (diffDays === 0) return 'Today';
            if (diffDays === 1) return 'Yesterday';
            if (diffDays < 7) return `${diffDays} days ago`;
            return date.toLocaleDateString();
        }

        function searchMembers() {
            const searchTerm = document.getElementById('memberSearch').value.toLowerCase().trim();
            const filter = document.getElementById('memberFilter').value;
            
            showMemberLoading(true);
            
            // Simulate search delay for better UX
            setTimeout(() => {
                let filtered = members.filter(member => {
                    const matchesSearch = !searchTerm || 
                                        member.name.toLowerCase().includes(searchTerm) ||
                                        member.email.toLowerCase().includes(searchTerm) ||
                                        member.phone.toLowerCase().includes(searchTerm) ||
                                        member.membershipType.toLowerCase().includes(searchTerm);
                    const matchesFilter = filter === 'all' || member.status === filter;
                    return matchesSearch && matchesFilter;
                });
                
                // Sort results by relevance
                if (searchTerm) {
                    filtered.sort((a, b) => {
                        const aNameMatch = a.name.toLowerCase().indexOf(searchTerm) !== -1;
                        const bNameMatch = b.name.toLowerCase().indexOf(searchTerm) !== -1;
                        if (aNameMatch && !bNameMatch) return -1;
                        if (!aNameMatch && bNameMatch) return 1;
                        return 0;
                    });
                }
                
                renderMembers(filtered);
                showMemberLoading(false);
                
                // Show no results message
                if (filtered.length === 0 && (searchTerm || filter !== 'all')) {
                    showNoResultsMessage(searchTerm, filter);
                }
            }, 200);
        }

        function addMember() {
            currentEditingMember = null;
            document.getElementById('memberModalTitle').textContent = 'Add New Member';
            document.getElementById('memberForm').reset();
            document.getElementById('memberStartDate').valueAsDate = new Date();
            openModal(document.getElementById('addEditMemberModal'));
        }

        function editMember(memberId) {
            const member = members.find(m => m.id === memberId);
            if (!member) return;
            
            currentEditingMember = member;
            document.getElementById('memberModalTitle').textContent = 'Edit Member';
            
            document.getElementById('memberName').value = member.name;
            document.getElementById('memberEmail').value = member.email;
            document.getElementById('memberPhone').value = member.phone;
            document.getElementById('memberType').value = member.membershipType;
            document.getElementById('memberStartDate').value = member.startDate;
            document.getElementById('memberNotes').value = member.notes || '';
            
            openModal(document.getElementById('addEditMemberModal'));
        }

        async function deleteMember(memberId) {
            const member = members.find(m => m.id === memberId);
            if (!member) return;
            
            const confirmed = await window.confirm(`Are you sure you want to delete ${member.name}? This action cannot be undone.`);
            if (confirmed) {
                // Show loading state
                showMemberLoading(true);
                
                // Simulate deletion delay
                setTimeout(() => {
                    members = members.filter(m => m.id !== memberId);
                    renderMembers();
                    showMemberLoading(false);
                    
                    // Show success message with member name
                    showNotification(`${member.name} has been deleted successfully`, 'success');
                    
                    // Animate member grid
                    gsap.fromTo('.member-grid', 
                        { scale: 0.98 },
                        { 
                            scale: 1, 
                            duration: 0.3,
                            ease: 'back.out(1.7)'
                        }
                    );
                }, 800);
            }
        }

        async function saveMember(formData) {
            try {
                const isEditing = !!currentEditingMember;
                const memberName = formData.name;
                
                // Show progress notification
                const progress = showProgressNotification(
                    isEditing ? 'Updating member...' : 'Adding new member...',
                );
                
                // Simulate API call with progress updates
                progress.updateProgress(25);
                await new Promise(resolve => setTimeout(resolve, 300));
                
                progress.updateProgress(50);
                await new Promise(resolve => setTimeout(resolve, 300));
                
                progress.updateProgress(75);
                await new Promise(resolve => setTimeout(resolve, 200));
                
                if (isEditing) {
                    // Update existing member
                    Object.assign(currentEditingMember, formData);
                } else {
                    // Add new member
                    const newMember = {
                        id: Math.max(...members.map(m => m.id)) + 1,
                        ...formData,
                        classesAttended: 0,
                        lastVisit: new Date().toISOString().split('T')[0],
                        status: 'active',
                        payments: []
                    };
                    members.push(newMember);
                }
                
                progress.updateProgress(100);
                await new Promise(resolve => setTimeout(resolve, 200));
                
                renderMembers();
                closeModal(document.getElementById('addEditMemberModal'));
                
                const message = isEditing 
                    ? `${memberName} updated successfully!` 
                    : `${memberName} added successfully!`;
                    
                progress.complete(message);
                
            } catch (error) {
                console.error('Error saving member:', error);
                showNotification('Failed to save member. Please try again.', 'error');
            }
        }

        function viewMemberDetails(memberId) {
            const member = members.find(m => m.id === memberId);
            if (!member) return;
            
            document.getElementById('memberDetailsTitle').textContent = `${member.name} - Details`;
            
            // Populate overview tab
            document.getElementById('memberOverview').innerHTML = `
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px;">
                    <div>
                        <h4 style="margin-bottom: 16px; color: var(--sl-neutral-700);">Personal Information</h4>
                        <p><strong>Name:</strong> ${member.name}</p>
                        <p><strong>Email:</strong> ${member.email}</p>
                        <p><strong>Phone:</strong> ${member.phone}</p>
                        <p><strong>Member Since:</strong> ${new Date(member.startDate).toLocaleDateString()}</p>
                        <p><strong>Status:</strong> <span class="subscription-status ${member.status}">${member.status.charAt(0).toUpperCase() + member.status.slice(1)}</span></p>
                    </div>
                    <div>
                        <h4 style="margin-bottom: 16px; color: var(--sl-neutral-700);">Activity Summary</h4>
                        <p><strong>Classes Attended:</strong> ${member.classesAttended}</p>
                        <p><strong>Last Visit:</strong> ${formatDate(member.lastVisit)}</p>
                        <p><strong>Membership Type:</strong> ${member.membershipType.charAt(0).toUpperCase() + member.membershipType.slice(1)}</p>
                        ${member.notes ? `<p><strong>Notes:</strong> ${member.notes}</p>` : ''}
                    </div>
                </div>
            `;
            
            // Populate subscription tab
            const membershipPrices = { basic: 300, standard: 450, premium: 650 };
            const nextPaymentDate = new Date();
            nextPaymentDate.setMonth(nextPaymentDate.getMonth() + 1);
            
            document.getElementById('memberSubscription').innerHTML = `
                <div class="subscription-card">
                    <div class="subscription-header">
                        <h4>${member.membershipType.charAt(0).toUpperCase() + member.membershipType.slice(1)} Membership</h4>
                        <span class="subscription-status ${member.status}">${member.status.charAt(0).toUpperCase() + member.status.slice(1)}</span>
                    </div>
                    <p><strong>Monthly Fee:</strong> R${membershipPrices[member.membershipType]}</p>
                    <p><strong>Start Date:</strong> ${new Date(member.startDate).toLocaleDateString()}</p>
                    <p><strong>Next Payment:</strong> ${nextPaymentDate.toLocaleDateString()}</p>
                </div>
            `;
            
            // Populate activity tab
            document.getElementById('memberActivity').innerHTML = `
                <div style="text-align: center; padding: 40px;">
                    <i class="fas fa-chart-line" style="font-size: 48px; color: var(--sl-neutral-400); margin-bottom: 16px;"></i>
                    <h4 style="color: var(--sl-neutral-600);">Activity Tracking</h4>
                    <p style="color: var(--sl-neutral-500);">Detailed activity tracking coming soon</p>
                </div>
            `;
            
            // Populate payments tab
            const paymentsHTML = member.payments.map(payment => `
                <div class="payment-item">
                    <div>
                        <strong>${new Date(payment.date).toLocaleDateString()}</strong>
                        <p style="color: var(--sl-neutral-500); font-size: 14px;">${payment.method}</p>
                    </div>
                    <div style="text-align: right;">
                        <div class="payment-amount">R${payment.amount}</div>
                        <span class="subscription-status ${payment.status.toLowerCase()}">${payment.status}</span>
                    </div>
                </div>
            `).join('');
            
            document.getElementById('memberPayments').innerHTML = `
                <div class="payment-history">
                    ${paymentsHTML || '<p style="text-align: center; color: var(--sl-neutral-500);">No payment history available</p>'}
                </div>
            `;
            
            // Reset to overview tab
            document.querySelectorAll('#memberDetailsModal .tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('#memberDetailsModal .tab-content').forEach(content => content.classList.remove('active'));
            document.querySelector('#memberDetailsModal .tab[data-tab="overview"]').classList.add('active');
            document.getElementById('overview-tab').classList.add('active');
            
            openModal(document.getElementById('memberDetailsModal'));
        }

        // Quick action buttons
        document.getElementById('manageStudentsBtn').addEventListener('click', openMemberManagement);

        document.getElementById('viewEarningsBtn').addEventListener('click', async () => {
            const button = document.getElementById('viewEarningsBtn');
            showButtonLoading(button, 'Loading...');
            
            try {
                // Show progress notification
                const progress = showProgressNotification('Loading earnings analytics...');
                
                // Simulate API calls with progress updates
                progress.updateProgress(20);
                await new Promise(resolve => setTimeout(resolve, 300));
                
                progress.updateProgress(50);
                await new Promise(resolve => setTimeout(resolve, 400));
                
                progress.updateProgress(80);
                await new Promise(resolve => setTimeout(resolve, 300));
                
                const earningsData = {
                    monthly: 'R 12,450',
                    weekly: 'R 3,210',
                    daily: 'R 460',
                    growth: '+15.3%'
                };
                
                progress.updateProgress(100);
                await new Promise(resolve => setTimeout(resolve, 200));
                
                const reportHTML = `
                    <div style="background: white; padding: 24px; border-radius: 12px; margin: 20px; max-width: 400px; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);">
                        <h3 style="color: var(--sl-brand); margin-bottom: 16px; display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-chart-line"></i> Earnings Summary
                        </h3>
                        <div style="display: grid; gap: 16px; margin-bottom: 20px;">
                            <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid var(--sl-neutral-200);">
                                <span style="color: var(--sl-neutral-600);">Monthly Earnings:</span>
                                <strong style="color: var(--sl-neutral-900);">${earningsData.monthly}</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid var(--sl-neutral-200);">
                                <span style="color: var(--sl-neutral-600);">Weekly Earnings:</span>
                                <strong style="color: var(--sl-neutral-900);">${earningsData.weekly}</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid var(--sl-neutral-200);">
                                <span style="color: var(--sl-neutral-600);">Daily Average:</span>
                                <strong style="color: var(--sl-neutral-900);">${earningsData.daily}</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 8px 0;">
                                <span style="color: var(--sl-neutral-600);">Growth:</span>
                                <strong style="color: var(--success); display: flex; align-items: center; gap: 4px;">
                                    <i class="fas fa-arrow-up" style="font-size: 12px;"></i>
                                    ${earningsData.growth}
                                </strong>
                            </div>
                        </div>
                        <div style="display: flex; gap: 12px;">
                            <button onclick="this.closest('div').parentElement.remove()" class="btn btn-secondary" style="flex: 1;">Close</button>
                            <button onclick="showNotification('Earnings report exported!', 'success'); this.closest('div').parentElement.remove();" class="btn btn-primary" style="flex: 1;">
                                <i class="fas fa-download"></i> Export
                            </button>
                        </div>
                    </div>
                `;
                
                const overlay = document.createElement('div');
                overlay.style.cssText = 'position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; display: flex; align-items: center; justify-content: center; backdrop-filter: blur(2px);';
                overlay.innerHTML = reportHTML;
                overlay.addEventListener('click', (e) => {
                    if (e.target === overlay) overlay.remove();
                });
                
                // Add entrance animation
                overlay.style.opacity = '0';
                document.body.appendChild(overlay);
                
                gsap.to(overlay, {
                    opacity: 1,
                    duration: 0.3,
                    ease: 'power2.out'
                });
                
                gsap.fromTo(overlay.querySelector('div'), 
                    { scale: 0.9, y: 20 },
                    { scale: 1, y: 0, duration: 0.4, ease: 'back.out(1.7)' }
                );
                
                progress.complete();
                
            } catch (error) {
                showNotification('Failed to load earnings report', 'error');
            } finally {
                hideButtonLoading(button);
            }
        });

        document.getElementById('whatsappBtn').addEventListener('click', () => {
            showNotification('Opening WhatsApp integration...', 'info');
            setTimeout(() => {
                const phoneNumber = '27821234567'; // Example South African number
                const message = encodeURIComponent('Hi! This is a message from your StudioLoop trainer dashboard. 💪');
                const whatsappURL = `https://wa.me/${phoneNumber}?text=${message}`;
                window.open(whatsappURL, '_blank');
                showNotification('WhatsApp opened successfully!', 'success');
            }, 500);
        });

        document.getElementById('equipmentBtn').addEventListener('click', () => {
            showNotification('Loading equipment inventory...', 'info');
            setTimeout(() => {
                const equipmentData = [
                    { name: 'Dumbbells Set', status: 'Available', condition: 'Good' },
                    { name: 'Yoga Mats', status: 'Available', condition: 'Excellent' },
                    { name: 'Resistance Bands', status: 'In Use', condition: 'Good' },
                    { name: 'Kettlebells', status: 'Available', condition: 'Fair' },
                    { name: 'Exercise Balls', status: 'Maintenance', condition: 'Needs Repair' }
                ];
                
                const inventoryHTML = `
                    <div style="background: white; padding: 24px; border-radius: 12px; margin: 20px; max-width: 500px; max-height: 80vh; overflow-y: auto;">
                        <h3 style="color: var(--sl-brand); margin-bottom: 16px;">
                            <i class="fas fa-dumbbell"></i> Equipment Inventory
                        </h3>
                        <div style="display: grid; gap: 12px;">
                            ${equipmentData.map(item => `
                                <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: var(--sl-neutral-50); border-radius: 8px;">
                                    <div>
                                        <strong>${item.name}</strong>
                                        <div style="color: var(--sl-neutral-600); font-size: 14px;">${item.condition}</div>
                                    </div>
                                    <span style="padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; 
                                        background: ${item.status === 'Available' ? 'rgba(16, 185, 129, 0.1)' : 
                                                     item.status === 'In Use' ? 'rgba(245, 158, 11, 0.1)' : 'rgba(239, 68, 68, 0.1)'};
                                        color: ${item.status === 'Available' ? 'var(--success)' : 
                                                 item.status === 'In Use' ? 'var(--warning)' : 'var(--danger)'};
                                    ">${item.status}</span>
                                </div>
                            `).join('')}
                        </div>
                        <button onclick="this.parentElement.parentElement.remove()" style="margin-top: 16px; padding: 8px 16px; background: var(--sl-brand); color: white; border: none; border-radius: 6px; cursor: pointer;">Close</button>
                    </div>
                `;
                
                const overlay = document.createElement('div');
                overlay.style.cssText = 'position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; display: flex; align-items: center; justify-content: center;';
                overlay.innerHTML = inventoryHTML;
                overlay.addEventListener('click', (e) => {
                    if (e.target === overlay) overlay.remove();
                });
                document.body.appendChild(overlay);
                
                showNotification('Equipment inventory loaded!', 'success');
            }, 800);
        });

        document.getElementById('settingsBtn').addEventListener('click', () => {
            showNotification('Opening trainer preferences...', 'info');
            setTimeout(() => {
                const settingsHTML = `
                    <div style="background: white; padding: 24px; border-radius: 12px; margin: 20px; max-width: 600px;">
                        <h3 style="color: var(--sl-brand); margin-bottom: 16px;">
                            <i class="fas fa-cog"></i> Trainer Preferences
                        </h3>
                        <form style="display: grid; gap: 16px;">
                            <div>
                                <label style="display: block; margin-bottom: 8px; font-weight: 600;">Notification Preferences</label>
                                <div style="display: grid; gap: 8px;">
                                    <label style="display: flex; align-items: center; gap: 8px;">
                                        <input type="checkbox" checked> Email notifications for new bookings
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 8px;">
                                        <input type="checkbox" checked> WhatsApp alerts for cancellations
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 8px;">
                                        <input type="checkbox"> Load shedding schedule updates
                                    </label>
                                </div>
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 8px; font-weight: 600;">Working Hours</label>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                                    <input type="time" value="06:00" style="padding: 8px; border: 1px solid var(--sl-neutral-300); border-radius: 6px;">
                                    <input type="time" value="20:00" style="padding: 8px; border: 1px solid var(--sl-neutral-300); border-radius: 6px;">
                                </div>
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 8px; font-weight: 600;">Default Class Duration</label>
                                <select style="width: 100%; padding: 8px; border: 1px solid var(--sl-neutral-300); border-radius: 6px;">
                                    <option>30 minutes</option>
                                    <option selected>45 minutes</option>
                                    <option>60 minutes</option>
                                    <option>90 minutes</option>
                                </select>
                            </div>
                            <div style="display: flex; gap: 12px; justify-content: flex-end; margin-top: 16px;">
                                <button type="button" onclick="this.closest('div').parentElement.parentElement.remove()" style="padding: 8px 16px; background: var(--sl-neutral-200); color: var(--sl-neutral-700); border: none; border-radius: 6px; cursor: pointer;">Cancel</button>
                                <button type="button" onclick="showNotification('Settings saved successfully!', 'success'); this.closest('div').parentElement.parentElement.remove();" style="padding: 8px 16px; background: var(--sl-brand); color: white; border: none; border-radius: 6px; cursor: pointer;">Save Changes</button>
                            </div>
                        </form>
                    </div>
                `;
                
                const overlay = document.createElement('div');
                overlay.style.cssText = 'position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; display: flex; align-items: center; justify-content: center;';
                overlay.innerHTML = settingsHTML;
                overlay.addEventListener('click', (e) => {
                    if (e.target === overlay) overlay.remove();
                });
                document.body.appendChild(overlay);
                
                showNotification('Settings panel opened!', 'success');
            }, 600);
        });

        // Notification bell with dropdown
        document.getElementById('notificationBtn').addEventListener('click', (e) => {
            e.stopPropagation();
            
            // Remove existing dropdown if present
            const existingDropdown = document.querySelector('.notification-dropdown');
            if (existingDropdown) {
                existingDropdown.remove();
                return;
            }
            
            const notifications = [
                { type: 'booking', icon: 'fas fa-calendar-check', message: 'New class booking from Zanele Dlamini', time: '5 mins ago', color: 'var(--success)' },
                { type: 'cancellation', icon: 'fas fa-calendar-times', message: 'Class cancellation from Michael Johnson', time: '12 mins ago', color: 'var(--danger)' },
                { type: 'payment', icon: 'fas fa-credit-card', message: 'Payment received from Priya Sharma', time: '1 hour ago', color: 'var(--sl-brand)' },
                { type: 'system', icon: 'fas fa-bolt', message: 'Load shedding alert: Stage 2 today', time: '2 hours ago', color: 'var(--warning)' }
            ];
            
            const dropdownHTML = `
                <div class="notification-dropdown" style="
                    position: absolute;
                    top: 60px;
                    right: 120px;
                    background: white;
                    border: 1px solid var(--sl-neutral-200);
                    border-radius: 12px;
                    box-shadow: 0 8px 25px rgba(0,0,0,0.15);
                    width: 350px;
                    max-height: 400px;
                    overflow-y: auto;
                    z-index: 1000;
                ">
                    <div style="padding: 16px; border-bottom: 1px solid var(--sl-neutral-200);">
                        <h4 style="margin: 0; color: var(--sl-neutral-900);">Notifications</h4>
                        <p style="margin: 4px 0 0; color: var(--sl-neutral-500); font-size: 14px;">${notifications.length} new notifications</p>
                    </div>
                    <div style="padding: 8px;">
                        ${notifications.map(notif => `
                            <div style="display: flex; gap: 12px; padding: 12px; border-radius: 8px; margin-bottom: 4px; cursor: pointer; transition: background 0.2s;" 
                                 onmouseover="this.style.background='var(--sl-neutral-50)'" 
                                 onmouseout="this.style.background='transparent'">
                                <div style="width: 32px; height: 32px; background: ${notif.color}; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 14px;">
                                    <i class="${notif.icon}"></i>
                                </div>
                                <div style="flex: 1;">
                                    <p style="margin: 0 0 4px; font-size: 14px; color: var(--sl-neutral-900);">${notif.message}</p>
                                    <p style="margin: 0; font-size: 12px; color: var(--sl-neutral-500);">${notif.time}</p>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    <div style="padding: 12px; border-top: 1px solid var(--sl-neutral-200); text-align: center;">
                        <button onclick="this.closest('.notification-dropdown').remove()" style="background: var(--sl-brand); color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px;">Mark All as Read</button>
                    </div>
                </div>
            `;
            
            const dropdown = document.createElement('div');
            dropdown.innerHTML = dropdownHTML;
            document.body.appendChild(dropdown.firstElementChild);
            
            // Close dropdown when clicking outside
            setTimeout(() => {
                document.addEventListener('click', function closeDropdown() {
                    const dropdown = document.querySelector('.notification-dropdown');
                    if (dropdown) {
                        dropdown.remove();
                        document.removeEventListener('click', closeDropdown);
                    }
                });
            }, 100);
        });

        // User menu with dropdown
        document.getElementById('userMenu').addEventListener('click', (e) => {
            e.stopPropagation();
            
            // Remove existing dropdown if present
            const existingDropdown = document.querySelector('.user-dropdown');
            if (existingDropdown) {
                existingDropdown.remove();
                return;
            }
            
            const userMenuHTML = `
                <div class="user-dropdown" style="
                    position: absolute;
                    top: 60px;
                    right: 20px;
                    background: white;
                    border: 1px solid var(--sl-neutral-200);
                    border-radius: 12px;
                    box-shadow: 0 8px 25px rgba(0,0,0,0.15);
                    width: 200px;
                    z-index: 1000;
                ">
                    <div style="padding: 16px; border-bottom: 1px solid var(--sl-neutral-200);">
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <div class="user-avatar">JD</div>
                            <div>
                                <h4 style="margin: 0; font-size: 14px;">John Doe</h4>
                                <p style="margin: 0; font-size: 12px; color: var(--sl-neutral-500);">Fitness Trainer</p>
                            </div>
                        </div>
                    </div>
                    <div style="padding: 8px;">
                        <button onclick="showNotification('Profile opened!', 'info'); this.closest('.user-dropdown').remove();" style="width: 100%; text-align: left; padding: 12px; background: none; border: none; border-radius: 6px; cursor: pointer; display: flex; align-items: center; gap: 12px; font-size: 14px;" onmouseover="this.style.background='var(--sl-neutral-50)'" onmouseout="this.style.background='none'">
                            <i class="fas fa-user"></i>
                            View Profile
                        </button>
                        <button onclick="showNotification('Account settings opened!', 'info'); this.closest('.user-dropdown').remove();" style="width: 100%; text-align: left; padding: 12px; background: none; border: none; border-radius: 6px; cursor: pointer; display: flex; align-items: center; gap: 12px; font-size: 14px;" onmouseover="this.style.background='var(--sl-neutral-50)'" onmouseout="this.style.background='none'">
                            <i class="fas fa-cog"></i>
                            Account Settings
                        </button>
                        <button onclick="showNotification('Help center opened!', 'info'); this.closest('.user-dropdown').remove();" style="width: 100%; text-align: left; padding: 12px; background: none; border: none; border-radius: 6px; cursor: pointer; display: flex; align-items: center; gap: 12px; font-size: 14px;" onmouseover="this.style.background='var(--sl-neutral-50)'" onmouseout="this.style.background='none'">
                            <i class="fas fa-question-circle"></i>
                            Help & Support
                        </button>
                        <hr style="margin: 8px 0; border: none; border-top: 1px solid var(--sl-neutral-200);">
                        <button onclick="confirm('Are you sure you want to logout?') && showNotification('Logged out successfully!', 'info'); this.closest('.user-dropdown').remove();" style="width: 100%; text-align: left; padding: 12px; background: none; border: none; border-radius: 6px; cursor: pointer; display: flex; align-items: center; gap: 12px; font-size: 14px; color: var(--danger);" onmouseover="this.style.background='rgba(239,68,68,0.1)'" onmouseout="this.style.background='none'">
                            <i class="fas fa-sign-out-alt"></i>
                            Logout
                        </button>
                    </div>
                </div>
            `;
            
            const dropdown = document.createElement('div');
            dropdown.innerHTML = userMenuHTML;
            document.body.appendChild(dropdown.firstElementChild);
            
            // Close dropdown when clicking outside
            setTimeout(() => {
                document.addEventListener('click', function closeUserDropdown() {
                    const dropdown = document.querySelector('.user-dropdown');
                    if (dropdown) {
                        dropdown.remove();
                        document.removeEventListener('click', closeUserDropdown);
                    }
                });
            }, 100);
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            // Escape key closes all modals and dropdowns
            if (e.key === 'Escape') {
                // Close modals
                document.querySelectorAll('.modal.active').forEach(modal => {
                    closeModal(modal);
                });
                
                // Close dropdowns
                document.querySelectorAll('.notification-dropdown, .user-dropdown').forEach(dropdown => {
                    dropdown.remove();
                });
                
                // Close mobile sidebar
                const sidebar = document.getElementById('sidebar');
                const overlay = document.getElementById('mobileOverlay');
                const toggle = document.getElementById('mobileMenuToggle');
                
                if (sidebar.classList.contains('open')) {
                    sidebar.classList.remove('open');
                    overlay.classList.remove('active');
                    toggle.classList.remove('active');
                    document.body.style.overflow = '';
                }
            }
            
            // Ctrl + M opens member management
            if (e.ctrlKey && e.key === 'm') {
                e.preventDefault();
                openMemberManagement();
            }
            
            // Ctrl + N creates new class
            if (e.ctrlKey && e.key === 'n') {
                e.preventDefault();
                openModal(createClassModal);
            }
        });

        // Animate metric cards on hover
        document.querySelectorAll('.metric-card').forEach(card => {
            card.addEventListener('mouseenter', () => {
                gsap.to(card, {
                    y: -8,
                    duration: 0.3,
                    ease: 'power2.out'
                });
            });
            
            card.addEventListener('mouseleave', () => {
                gsap.to(card, {
                    y: 0,
                    duration: 0.3,
                    ease: 'power2.out'
                });
            });
        });

        // Animate class cards
        document.querySelectorAll('.class-card').forEach(card => {
            card.addEventListener('click', () => {
                gsap.to(card, {
                    scale: 0.98,
                    duration: 0.1,
                    yoyo: true,
                    repeat: 1
                });
            });
        });

        // Enhanced Chart.js implementation with better error handling
        let currentChart = null;
        let currentPeriod = 'week';
        
        const chartData = {
            week: {
                labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                datasets: [{
                    label: 'Classes Taught',
                    data: [4, 6, 5, 8, 7, 9, 6],
                    borderColor: 'rgb(0, 119, 255)',
                    backgroundColor: 'rgba(0, 119, 255, 0.08)',
                    tension: 0.4,
                    fill: true,
                    pointBackgroundColor: 'rgb(0, 119, 255)',
                    pointBorderColor: '#fff',
                    pointBorderWidth: 3,
                    pointRadius: 5,
                    pointHoverRadius: 7
                }, {
                    label: 'Revenue (R)',
                    data: [1800, 2700, 2250, 3600, 3150, 4050, 2700],
                    borderColor: 'rgb(0, 229, 255)',
                    backgroundColor: 'rgba(0, 229, 255, 0.08)',
                    tension: 0.4,
                    fill: true,
                    pointBackgroundColor: 'rgb(0, 229, 255)',
                    pointBorderColor: '#fff',
                    pointBorderWidth: 3,
                    pointRadius: 5,
                    pointHoverRadius: 7
                }, {
                    label: 'Attendance Rate (%)',
                    data: [85, 92, 78, 96, 89, 94, 88],
                    borderColor: 'rgb(142, 36, 170)',
                    backgroundColor: 'rgba(142, 36, 170, 0.08)',
                    tension: 0.4,
                    fill: true,
                    pointBackgroundColor: 'rgb(142, 36, 170)',
                    pointBorderColor: '#fff',
                    pointBorderWidth: 3,
                    pointRadius: 5,
                    pointHoverRadius: 7
                }]
            },
            month: {
                labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4'],
                datasets: [{
                    label: 'Classes Taught',
                    data: [28, 32, 25, 35],
                    borderColor: 'rgb(0, 119, 255)',
                    backgroundColor: 'rgba(0, 119, 255, 0.08)',
                    tension: 0.4,
                    fill: true,
                    pointBackgroundColor: 'rgb(0, 119, 255)',
                    pointBorderColor: '#fff',
                    pointBorderWidth: 3,
                    pointRadius: 6,
                    pointHoverRadius: 8
                }, {
                    label: 'Revenue (R)',
                    data: [12600, 14400, 11250, 15750],
                    borderColor: 'rgb(0, 229, 255)',
                    backgroundColor: 'rgba(0, 229, 255, 0.08)',
                    tension: 0.4,
                    fill: true,
                    pointBackgroundColor: 'rgb(0, 229, 255)',
                    pointBorderColor: '#fff',
                    pointBorderWidth: 3,
                    pointRadius: 6,
                    pointHoverRadius: 8
                }, {
                    label: 'Attendance Rate (%)',
                    data: [89, 91, 87, 93],
                    borderColor: 'rgb(142, 36, 170)',
                    backgroundColor: 'rgba(142, 36, 170, 0.08)',
                    tension: 0.4,
                    fill: true,
                    pointBackgroundColor: 'rgb(142, 36, 170)',
                    pointBorderColor: '#fff',
                    pointBorderWidth: 3,
                    pointRadius: 6,
                    pointHoverRadius: 8
                }]
            },
            year: {
                labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
                datasets: [{
                    label: 'Classes Taught',
                    data: [120, 105, 135, 125, 140, 155, 148, 162, 158, 145, 138, 142],
                    borderColor: 'rgb(0, 119, 255)',
                    backgroundColor: 'rgba(0, 119, 255, 0.08)',
                    tension: 0.4,
                    fill: true,
                    pointBackgroundColor: 'rgb(0, 119, 255)',
                    pointBorderColor: '#fff',
                    pointBorderWidth: 2,
                    pointRadius: 4,
                    pointHoverRadius: 6
                }, {
                    label: 'Revenue (R)',
                    data: [54000, 47250, 60750, 56250, 63000, 69750, 66600, 72900, 71100, 65250, 62100, 63900],
                    borderColor: 'rgb(0, 229, 255)',
                    backgroundColor: 'rgba(0, 229, 255, 0.08)',
                    tension: 0.4,
                    fill: true,
                    pointBackgroundColor: 'rgb(0, 229, 255)',
                    pointBorderColor: '#fff',
                    pointBorderWidth: 2,
                    pointRadius: 4,
                    pointHoverRadius: 6
                }]
            }
        };
        function showChartLoading() {
            document.querySelector('.chart-container').innerHTML = `
                <div style="display: flex; align-items: center; justify-content: center; height: 100%; color: var(--sl-neutral-500);">
                    <div style="text-align: center;">
                        <i class="fas fa-spinner fa-spin" style="font-size: 32px; margin-bottom: 12px;"></i>
                        <p>Loading analytics...</p>
                    </div>
                </div>
            `;
        }
        
        function showChartError(message = 'Error loading analytics') {
            document.querySelector('.chart-container').innerHTML = `
                <div style="display: flex; align-items: center; justify-content: center; height: 100%; color: var(--danger);">
                    <div style="text-align: center;">
                        <i class="fas fa-exclamation-triangle" style="font-size: 32px; margin-bottom: 12px;"></i>
                        <p style="margin-bottom: 12px;">${message}</p>
                        <button onclick="initializeChart()" class="btn btn-secondary" style="font-size: 14px; padding: 8px 16px;">
                            <i class="fas fa-redo"></i> Retry
                        </button>
                    </div>
                </div>
            `;
        }
        
        function initializeChart() {
            showChartLoading();
            
            // Check if Chart.js is loaded
            if (typeof Chart === 'undefined') {
                console.error('Chart.js library not loaded');
                setTimeout(() => {
                    if (typeof Chart === 'undefined') {
                        showChartError('Chart library failed to load. Please refresh the page.');
                    } else {
                        initializeChart();
                    }
                }, 2000);
                return;
            }
            
            try {
                // Simulate data loading
                setTimeout(() => {
                    const chartContainer = document.querySelector('.chart-container');
                    chartContainer.innerHTML = '<canvas id="performanceChart"></canvas>';
                    
                    const ctx = document.getElementById('performanceChart').getContext('2d');
                    
                    // Get data for current period
                    const data = chartData[currentPeriod];
                    
                    currentChart = new Chart(ctx, {
                        type: 'line',
                        data: data,
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'bottom',
                                    labels: {
                                        usePointStyle: true,
                                        padding: 20,
                                        font: {
                                            family: 'Inter',
                                            size: 12,
                                            weight: '500'
                                        }
                                    }
                                },
                                tooltip: {
                                    mode: 'index',
                                    intersect: false,
                                    backgroundColor: '#ffffff',
                                    titleColor: '#374151',
                                    bodyColor: '#374151',
                                    borderColor: '#e5e7eb',
                                    borderWidth: 1,
                                    cornerRadius: 8,
                                    titleFont: {
                                        family: 'Inter',
                                        size: 14,
                                        weight: '600'
                                    },
                                    bodyFont: {
                                        family: 'Inter',
                                        size: 13
                                    },
                                    callbacks: {
                                        title: function(context) {
                                            return context[0].label;
                                        },
                                        label: function(context) {
                                            const label = context.dataset.label || '';
                                            const value = context.parsed.y;
                                            if (label.includes('Revenue')) {
                                                return `${label}: R${value.toLocaleString()}`;
                                            } else if (label.includes('Attendance')) {
                                                return `${label}: ${value}%`;
                                            }
                                            return `${label}: ${value}`;
                                        }
                                    }
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    grid: {
                                        color: 'rgba(148, 163, 184, 0.1)',
                                        drawBorder: false
                                    },
                                    ticks: {
                                        color: 'var(--sl-neutral-600)',
                                        font: {
                                            family: 'Inter',
                                            size: 11
                                        },
                                        padding: 8
                                    }
                                },
                                x: {
                                    grid: {
                                        color: 'rgba(148, 163, 184, 0.1)',
                                        drawBorder: false
                                    },
                                    ticks: {
                                        color: 'var(--sl-neutral-600)',
                                        font: {
                                            family: 'Inter',
                                            size: 11
                                        },
                                        padding: 8
                                    }
                                }
                            },
                            elements: {
                                point: {
                                    radius: 5,
                                    hoverRadius: 8,
                                    hitRadius: 10
                                }
                            },
                            interaction: {
                                mode: 'nearest',
                                axis: 'x',
                                intersect: false
                            },
                            animation: {
                                duration: 1000,
                                easing: 'easeOutQuart'
                            }
                        }
                    });

                    // Store chart reference for updates
                    window.performanceChart = performanceChart;
                    
                    // Add chart controls
                    addChartControls(performanceChart);
                    
                }, 500);

            } catch (error) {
                console.error('Error initializing chart:', error);
                showChartError('Failed to initialize analytics chart');
            }
        }
        
        function refreshAnalytics() {
            const btn = event.target.closest('button');
            const icon = btn.querySelector('i');
            
            // Animate refresh button
            gsap.to(icon, {
                rotation: 360,
                duration: 0.6,
                ease: 'power2.inOut'
            });
            
            // Reinitialize chart
            setTimeout(() => {
                initializeChart(currentPeriod);
            }, 300);
        }
        
        function addChartControls(chart) {
            const chartSection = document.querySelector('.content-section:has(.chart-container)');
            const existingControls = chartSection.querySelector('.chart-controls');
            
            if (!existingControls) {
                const controls = document.createElement('div');
                controls.className = 'chart-controls';
                controls.style.cssText = `
                    display: flex;
                    gap: 12px;
                    margin-bottom: 16px;
                    align-items: center;
                `;
                
                controls.innerHTML = `
                    <button class="btn btn-secondary chart-period active" data-period="week" style="font-size: 12px; padding: 6px 12px;">
                        Week
                    </button>
                    <button class="btn btn-secondary chart-period" data-period="month" style="font-size: 12px; padding: 6px 12px;">
                        Month
                    </button>
                    <button class="btn btn-secondary chart-period" data-period="year" style="font-size: 12px; padding: 6px 12px;">
                        Year
                    </button>
                    <div style="margin-left: auto; display: flex; align-items: center; gap: 8px;">
                        <button onclick="updateChartData()" class="btn btn-secondary" style="font-size: 12px; padding: 6px 12px;" title="Refresh data">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                    </div>
                `;
                
                chartSection.insertBefore(controls, chartSection.querySelector('.chart-container'));
                
                // Add period toggle functionality
                controls.querySelectorAll('.chart-period').forEach(btn => {
                    btn.addEventListener('click', () => {
                        controls.querySelectorAll('.chart-period').forEach(b => {
                            b.classList.remove('active');
                            b.style.background = 'var(--sl-neutral-200)';
                            b.style.color = 'var(--sl-neutral-700)';
                        });
                        btn.classList.add('active');
                        btn.style.background = 'var(--sl-brand)';
                        btn.style.color = 'white';
                        
                        updateChartPeriod(btn.dataset.period, chart);
                    });
                });
            }
        }
        
        function updateChartPeriod(period, chart) {
            const periodData = {
                week: {
                    labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                    classes: [4, 6, 5, 8, 7, 9, 6],
                    attendance: [85, 92, 78, 96, 89, 94, 88]
                },
                month: {
                    labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4'],
                    classes: [25, 28, 22, 30],
                    attendance: [88, 91, 85, 93]
                },
                year: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
                    classes: [95, 102, 118, 125, 140, 138, 145, 142, 128, 135, 120, 110],
                    attendance: [86, 89, 91, 88, 92, 90, 94, 91, 87, 89, 85, 83]
                }
            };
            
            const data = periodData[period];
            chart.data.labels = data.labels;
            chart.data.datasets[0].data = data.classes;
            chart.data.datasets[1].data = data.attendance;
            chart.update('active');
        }
        
        function updateChartData() {
            if (window.performanceChart) {
                showNotification('Refreshing chart data...', 'info');
                
                // Simulate data refresh
                setTimeout(() => {
                    const currentData = window.performanceChart.data.datasets[0].data;
                    const newData = currentData.map(val => Math.max(0, val + Math.floor(Math.random() * 3) - 1));
                    const newAttendance = window.performanceChart.data.datasets[1].data.map(val => 
                        Math.max(60, Math.min(100, val + Math.floor(Math.random() * 6) - 3))
                    );
                    
                    window.performanceChart.data.datasets[0].data = newData;
                    window.performanceChart.data.datasets[1].data = newAttendance;
                    window.performanceChart.update('active');
                    
                    showNotification('Chart data updated successfully!', 'success');
                }, 800);
            }
        }

        // Initialize dashboard when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize page animations
            initializePageAnimations();
            
            // Small delay to ensure all resources are loaded
            setTimeout(() => {
                initializeChart();
                
                // Add period toggle functionality
                const periodButtons = document.querySelectorAll('.chart-period');
                periodButtons.forEach(btn => {
                    btn.addEventListener('click', () => {
                        const period = btn.getAttribute('data-period');
                        currentPeriod = period;
                        
                        // Update active state
                        periodButtons.forEach(b => b.classList.remove('active'));
                        btn.classList.add('active');
                        
                        // Reinitialize chart with new period
                        if (currentChart) {
                            currentChart.destroy();
                        }
                        initializeChart();
                    });
                });
                
                // Start auto-refresh for live data
                startAutoRefresh();
                
            }, 500);
        });
        
        // Retry mechanism if chart fails to load
        let chartRetryCount = 0;
        const maxChartRetries = 3;
        
        function retryChartInitialization() {
            if (chartRetryCount < maxChartRetries) {
                chartRetryCount++;
                console.log(`Retrying chart initialization (attempt ${chartRetryCount}/${maxChartRetries})`);
                setTimeout(() => {
                    if (typeof Chart === 'undefined') {
                        retryChartInitialization();
                    } else {
                        initializeChart();
                    }
                }, 1000 * chartRetryCount);
            } else {
                showChartError('Chart library failed to load after multiple attempts. Please refresh the page.');
            }
        }
        
        // Check if Chart.js loaded successfully
        window.addEventListener('load', () => {
            if (typeof Chart === 'undefined') {
                retryChartInitialization();
            }
        });

        // Load Shedding Alert Dismiss Function
        function dismissLoadSheddingAlert() {
            const alert = document.getElementById('loadSheddingAlert');
            if (alert) {
                gsap.to(alert, {
                    opacity: 0,
                    y: -20,
                    duration: 0.4,
                    ease: 'power2.inOut',
                    onComplete: () => {
                        alert.style.display = 'none';
                        showNotification('Load shedding alert dismissed', 'info', 3000);
                    }
                });
            }
        }
        
        // Enhanced Page Load Animations
        function initializePageAnimations() {
            // Stagger animation for metric cards
            gsap.fromTo('.metric-card', 
                { opacity: 0, y: 30, scale: 0.95 },
                { 
                    opacity: 1, 
                    y: 0, 
                    scale: 1,
                    duration: 0.6,
                    stagger: 0.1,
                    ease: 'power2.out',
                    delay: 0.2
                }
            );
            
            // Animate sidebar navigation
            gsap.fromTo('.nav-link', 
                { opacity: 0, x: -20 },
                { 
                    opacity: 1, 
                    x: 0,
                    duration: 0.4,
                    stagger: 0.05,
                    ease: 'power2.out',
                    delay: 0.1
                }
            );
            
            // Animate header
            gsap.fromTo('.header', 
                { opacity: 0, y: -20 },
                { 
                    opacity: 1, 
                    y: 0,
                    duration: 0.6,
                    ease: 'power2.out'
                }
            );
            
            // Animate load shedding alert
            gsap.fromTo('.load-shedding-alert', 
                { opacity: 0, y: -30, scale: 0.95 },
                { 
                    opacity: 1, 
                    y: 0, 
                    scale: 1,
                    duration: 0.6,
                    ease: 'back.out(1.7)',
                    delay: 0.4
                }
            );
            
            // Animate chart container
            gsap.fromTo('.chart-container', 
                { opacity: 0, x: 30 },
                { 
                    opacity: 1, 
                    x: 0,
                    duration: 0.6,
                    ease: 'power2.out',
                    delay: 0.6
                }
            );
            
            // Animate notifications
            gsap.fromTo('.notification-item', 
                { opacity: 0, x: 20 },
                { 
                    opacity: 1, 
                    x: 0,
                    duration: 0.4,
                    stagger: 0.1,
                    ease: 'power2.out',
                    delay: 0.8
                }
            );
        }

        // Enhanced auto-refresh with visual feedback
        function startAutoRefresh() {
            // Update notification badge randomly
            setInterval(() => {
                const badge = document.querySelector('.notification-badge');
                if (badge) {
                    const currentCount = parseInt(badge.textContent);
                    const newCount = Math.max(0, currentCount + Math.floor(Math.random() * 3) - 1);
                    
                    if (newCount !== currentCount) {
                        // Animate badge change
                        gsap.to(badge, {
                            scale: 1.2,
                            duration: 0.2,
                            yoyo: true,
                            repeat: 1,
                            ease: 'power2.out',
                            onComplete: () => {
                                badge.textContent = newCount;
                                badge.style.display = newCount > 0 ? 'flex' : 'none';
                            }
                        });
                    }
                }
            }, 45000); // Increased interval for better UX
            
            // Periodic metric updates with visual feedback
            setInterval(() => {
                updateDashboardMetrics();
            }, 120000);
        }
        
        function updateDashboardMetrics() {
            const metricCards = document.querySelectorAll('.metric-card');
            metricCards.forEach((card, index) => {
                setTimeout(() => {
                    const value = card.querySelector('.metric-value');
                    const change = card.querySelector('.metric-change');
                    
                    if (value && change) {
                        // Add loading state
                        card.classList.add('loading');
                        
                        setTimeout(() => {
                            // Simulate data update
                            const currentValue = value.textContent;
                            let newValue = currentValue;
                            
                            if (currentValue.includes('R ')) {
                                const num = parseInt(currentValue.replace('R ', '').replace(',', ''));
                                newValue = `R ${(num + Math.floor(Math.random() * 200) - 100).toLocaleString()}`;
                            } else if (currentValue.includes('%')) {
                                const num = parseInt(currentValue.replace('%', ''));
                                newValue = `${Math.max(60, Math.min(100, num + Math.floor(Math.random() * 6) - 3))}%`;
                            } else {
                                const num = parseInt(currentValue);
                                newValue = Math.max(0, num + Math.floor(Math.random() * 3) - 1).toString();
                            }
                            
                            // Animate value change
                            gsap.to(value, {
                                textContent: newValue,
                                duration: 1,
                                snap: { textContent: 1 },
                                ease: 'power2.out'
                            });
                            
                            // Remove loading state
                            card.classList.remove('loading');
                            
                        }, 500);
                    }
                }, index * 200);
            });
        }
        
        // Start auto-refresh when page loads
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                startAutoRefresh();
            }, 2000);
        });

        // Loading state helpers
        function showLoading(element, text = 'Loading...') {
            if (typeof element === 'string') {
                element = document.querySelector(element);
            }
            if (!element) return;
            
            element.classList.add('loading');
            element.setAttribute('aria-busy', 'true');
            
            if (text && element.tagName === 'BUTTON') {
                element._originalText = element.innerHTML;
                element.innerHTML = `<i class="fas fa-spinner fa-spin"></i> ${text}`;
            }
        }
        
        function hideLoading(element) {
            if (typeof element === 'string') {
                element = document.querySelector(element);
            }
            if (!element) return;
            
            element.classList.remove('loading');
            element.setAttribute('aria-busy', 'false');
            
            if (element._originalText) {
                element.innerHTML = element._originalText;
                delete element._originalText;
            }
        }
        
        // Enhanced loading states for async operations
        function showButtonLoading(button, loadingText = 'Please wait...') {
            if (typeof button === 'string') {
                button = document.querySelector(button);
            }
            if (!button) return;
            
            button.disabled = true;
            button._originalText = button.innerHTML;
            button.innerHTML = `<i class="fas fa-spinner fa-spin"></i> ${loadingText}`;
        }
        
        function hideButtonLoading(button, newText = null) {
            if (typeof button === 'string') {
                button = document.querySelector(button);
            }
            if (!button) return;
            
            button.disabled = false;
            button.innerHTML = newText || button._originalText || 'Submit';
            delete button._originalText;
        }

        // Initialize date inputs with today's date
        document.addEventListener('DOMContentLoaded', () => {
            const classDateInput = document.getElementById('classDate');
            if (classDateInput) {
                classDateInput.valueAsDate = new Date();
            }
        });
        
        // Error boundary for handling unexpected errors
        window.addEventListener('error', (event) => {
            console.error('Application Error:', event.error);
            showNotification('An unexpected error occurred. Please refresh the page.', 'error');
        });
        
        // Handle unhandled promise rejections
        window.addEventListener('unhandledrejection', (event) => {
            console.error('Unhandled Promise Rejection:', event.reason);
            showNotification('A network error occurred. Please check your connection.', 'error');
            event.preventDefault();
        });
        
        // Performance monitoring
        function monitorPerformance() {
            if ('performance' in window) {
                const navigation = performance.getEntriesByType('navigation')[0];
                if (navigation && navigation.loadEventEnd - navigation.loadEventStart > 3000) {
                    console.warn('Slow page load detected:', navigation.loadEventEnd - navigation.loadEventStart + 'ms');
                }
            }
        }
        
        // Run performance monitoring after page load
        window.addEventListener('load', () => {
            setTimeout(monitorPerformance, 1000);
        });

        // Member Management Modal Event Listeners
        const memberManagementModal = document.getElementById('memberManagementModal');
        const addEditMemberModal = document.getElementById('addEditMemberModal');
        const memberDetailsModal = document.getElementById('memberDetailsModal');

        // Close modal event handlers
        document.getElementById('closeMemberModal').addEventListener('click', () => {
            closeModal(memberManagementModal);
        });

        document.getElementById('closeMemberManagement').addEventListener('click', () => {
            closeModal(memberManagementModal);
        });

        document.getElementById('closeAddEditModal').addEventListener('click', () => {
            closeModal(addEditMemberModal);
        });

        document.getElementById('closeMemberDetailsModal').addEventListener('click', () => {
            closeModal(memberDetailsModal);
        });

        document.getElementById('cancelMemberForm').addEventListener('click', () => {
            closeModal(addEditMemberModal);
        });

        document.getElementById('closeMemberDetails').addEventListener('click', () => {
            closeModal(memberDetailsModal);
        });

        // Add member button
        document.getElementById('addMemberBtn').addEventListener('click', addMember);

        // Enhanced search and filter functionality with performance optimization
        let searchTimeout;
        let lastSearchQuery = '';
        
        function debounceSearch(callback, delay = 300) {
            return function(...args) {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => callback.apply(this, args), delay);
            };
        }
        
        const debouncedSearch = debounceSearch(() => {
            const currentQuery = document.getElementById('memberSearch').value.trim();
            // Only search if query has changed
            if (currentQuery !== lastSearchQuery) {
                lastSearchQuery = currentQuery;
                searchMembers();
            }
        }, 300);
        
        document.getElementById('memberSearch').addEventListener('input', debouncedSearch);
        
        document.getElementById('memberFilter').addEventListener('change', searchMembers);
        
        // Add clear search button functionality
        const searchInput = document.getElementById('memberSearch');
        searchInput.addEventListener('input', (e) => {
            const clearBtn = searchInput.parentNode.querySelector('.clear-search');
            if (e.target.value.length > 0) {
                if (!clearBtn) {
                    const clearButton = document.createElement('button');
                    clearButton.className = 'clear-search';
                    clearButton.innerHTML = '<i class="fas fa-times"></i>';
                    clearButton.style.cssText = `
                        position: absolute;
                        right: 8px;
                        top: 50%;
                        transform: translateY(-50%);
                        background: none;
                        border: none;
                        color: var(--sl-neutral-400);
                        cursor: pointer;
                        padding: 4px;
                        border-radius: 4px;
                    `;
                    clearButton.addEventListener('click', () => {
                        searchInput.value = '';
                        clearButton.remove();
                        searchMembers();
                        searchInput.focus();
                    });
                    searchInput.parentNode.style.position = 'relative';
                    searchInput.parentNode.appendChild(clearButton);
                }
            } else if (clearBtn) {
                clearBtn.remove();
            }
        });

        // Enhanced form validation
        function validateField(fieldId, value, rules) {
            const field = document.getElementById(fieldId);
            const existingError = field.parentNode.querySelector('.field-error');
            const existingSuccess = field.parentNode.querySelector('.field-success');
            
            // Clear existing validation states
            if (existingError) existingError.remove();
            if (existingSuccess) existingSuccess.remove();
            field.classList.remove('error', 'success');
            
            // Apply validation rules
            for (const rule of rules) {
                if (!rule.test(value)) {
                    field.classList.add('error');
                    const errorMsg = document.createElement('div');
                    errorMsg.className = 'field-error';
                    errorMsg.innerHTML = `<i class="fas fa-exclamation-circle"></i> ${rule.message}`;
                    field.parentNode.appendChild(errorMsg);
                    return false;
                }
            }
            
            // Field is valid
            field.classList.add('success');
            const successMsg = document.createElement('div');
            successMsg.className = 'field-success';
            successMsg.innerHTML = `<i class="fas fa-check-circle"></i> Valid`;
            field.parentNode.appendChild(successMsg);
            return true;
        }
        
        function validateMemberForm() {
            const validations = [
                {
                    field: 'memberName',
                    value: document.getElementById('memberName').value.trim(),
                    rules: [
                        {
                            test: (value) => value.length >= 2,
                            message: 'Name must be at least 2 characters long'
                        },
                        {
                            test: (value) => /^[a-zA-Z\s]+$/.test(value),
                            message: 'Name can only contain letters and spaces'
                        }
                    ]
                },
                {
                    field: 'memberEmail',
                    value: document.getElementById('memberEmail').value.trim(),
                    rules: [
                        {
                            test: (value) => value.length > 0,
                            message: 'Email is required'
                        },
                        {
                            test: (value) => /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(value),
                            message: 'Please enter a valid email address'
                        },
                        {
                            test: (value) => !members.some(m => m.email === value && (!currentEditingMember || m.id !== currentEditingMember.id)),
                            message: 'Email address already exists'
                        }
                    ]
                },
                {
                    field: 'memberPhone',
                    value: document.getElementById('memberPhone').value.trim(),
                    rules: [
                        {
                            test: (value) => value.length > 0,
                            message: 'Phone number is required'
                        },
                        {
                            test: (value) => /^[\+]?[0-9\s\-\(\)]{10,}$/.test(value),
                            message: 'Please enter a valid phone number'
                        }
                    ]
                },
                {
                    field: 'memberType',
                    value: document.getElementById('memberType').value,
                    rules: [
                        {
                            test: (value) => value !== '',
                            message: 'Please select a membership type'
                        }
                    ]
                },
                {
                    field: 'memberStartDate',
                    value: document.getElementById('memberStartDate').value,
                    rules: [
                        {
                            test: (value) => value !== '',
                            message: 'Start date is required'
                        },
                        {
                            test: (value) => {
                                const date = new Date(value);
                                const now = new Date();
                                const oneYearAgo = new Date();
                                oneYearAgo.setFullYear(now.getFullYear() - 1);
                                return date >= oneYearAgo && date <= now;
                            },
                            message: 'Start date must be within the last year and not in the future'
                        }
                    ]
                }
            ];
            
            let isValid = true;
            for (const validation of validations) {
                if (!validateField(validation.field, validation.value, validation.rules)) {
                    isValid = false;
                }
            }
            
            return isValid;
        }
        
        // Real-time validation for member form
        ['memberName', 'memberEmail', 'memberPhone', 'memberType', 'memberStartDate'].forEach(fieldId => {
            const field = document.getElementById(fieldId);
            if (field) {
                let validationTimeout;
                field.addEventListener('input', () => {
                    clearTimeout(validationTimeout);
                    validationTimeout = setTimeout(() => {
                        // Only validate if field has content (except for required validation)
                        if (field.value.trim().length > 0 || field.type === 'select-one') {
                            validateMemberForm();
                        }
                    }, 500);
                });
                
                field.addEventListener('blur', () => {
                    validateMemberForm();
                });
            }
        });
        
        // Enhanced member form submission
        document.getElementById('memberForm').addEventListener('submit', (e) => {
            e.preventDefault();
            
            // Show loading state
            const submitBtn = document.getElementById('saveMemberBtn');
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';
            submitBtn.disabled = true;
            
            // Validate form
            if (!validateMemberForm()) {
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
                showNotification('Please correct the errors above', 'error');
                
                // Focus first error field
                const firstError = document.querySelector('.form-input.error, .form-select.error');
                if (firstError) firstError.focus();
                return;
            }
            
            // Get form data
            const formData = {
                name: document.getElementById('memberName').value.trim(),
                email: document.getElementById('memberEmail').value.trim(),
                phone: document.getElementById('memberPhone').value.trim(),
                membershipType: document.getElementById('memberType').value,
                startDate: document.getElementById('memberStartDate').value,
                notes: document.getElementById('memberNotes').value.trim()
            };
            
            // Simulate save delay
            setTimeout(() => {
                try {
                    saveMember(formData);
                } catch (error) {
                    showNotification('Failed to save member. Please try again.', 'error');
                } finally {
                    submitBtn.innerHTML = originalText;
                    submitBtn.disabled = false;
                }
            }, 800);
        });

        // Tab functionality for member details modal
        document.querySelectorAll('#memberDetailsModal .tab').forEach(tab => {
            tab.addEventListener('click', () => {
                const tabName = tab.getAttribute('data-tab');
                
                // Remove active class from all tabs and content
                document.querySelectorAll('#memberDetailsModal .tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('#memberDetailsModal .tab-content').forEach(content => content.classList.remove('active'));
                
                // Add active class to clicked tab and corresponding content
                tab.classList.add('active');
                document.getElementById(tabName + '-tab').classList.add('active');
            });
        });

        // Enhanced mobile menu toggle
        document.getElementById('mobileMenuToggle').addEventListener('click', () => {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('mobileOverlay');
            const toggle = document.getElementById('mobileMenuToggle');
            
            sidebar.classList.toggle('open');
            overlay.classList.toggle('active');
            toggle.classList.toggle('active');
            
            // Prevent body scroll when menu is open
            if (sidebar.classList.contains('open')) {
                document.body.style.overflow = 'hidden';
            } else {
                document.body.style.overflow = '';
            }
        });
        
        // Close mobile menu when overlay is clicked
        document.getElementById('mobileOverlay').addEventListener('click', () => {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('mobileOverlay');
            const toggle = document.getElementById('mobileMenuToggle');
            
            sidebar.classList.remove('open');
            overlay.classList.remove('active');
            toggle.classList.remove('active');
            document.body.style.overflow = '';
        });

        // Close modals when clicking outside
        [memberManagementModal, addEditMemberModal, memberDetailsModal].forEach(modal => {
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    closeModal(modal);
                }
            });
        });

        // Handle window resize
        window.addEventListener('resize', () => {
            if (window.innerWidth > 768) {
                const sidebar = document.getElementById('sidebar');
                const overlay = document.getElementById('mobileOverlay');
                const toggle = document.getElementById('mobileMenuToggle');
                
                // Reset mobile states when returning to desktop
                sidebar.classList.remove('open');
                overlay.classList.remove('active');
                toggle.classList.remove('active');
                document.body.style.overflow = '';
            }
        });

        // Enhanced notification system with better UX
        let notificationContainer;
        let notificationQueue = [];
        let isShowingNotification = false;
        
        function initNotificationSystem() {
            if (!notificationContainer) {
                notificationContainer = document.createElement('div');
                notificationContainer.className = 'notification-container';
                notificationContainer.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    z-index: 10000;
                    pointer-events: none;
                    max-width: 400px;
                `;
                document.body.appendChild(notificationContainer);
            }
        }
        
        function showNotification(message, type = 'success', duration = 4000) {
            initNotificationSystem();
            
            // Queue notifications to avoid overlap
            notificationQueue.push({ message, type, duration });
            processNotificationQueue();
        }
        
        function processNotificationQueue() {
            if (isShowingNotification || notificationQueue.length === 0) return;
            
            isShowingNotification = true;
            const { message, type, duration } = notificationQueue.shift();
            
            const notification = document.createElement('div');
            notification.className = `notification-toast ${type}`;
            
            const icons = {
                success: 'fas fa-check-circle',
                error: 'fas fa-exclamation-circle',
                warning: 'fas fa-exclamation-triangle',
                info: 'fas fa-info-circle'
            };
            
            const colors = {
                success: 'var(--success)',
                error: 'var(--danger)',
                warning: 'var(--warning)',
                info: 'var(--sl-brand)'
            };
            
            notification.innerHTML = `
                <div style="display: flex; align-items: center; gap: 12px;">
                    <i class="${icons[type] || icons.info}" style="font-size: 18px;"></i>
                    <span style="flex: 1;">${escapeHtml(message)}</span>
                    <button class="notification-close" style="
                        background: none;
                        border: none;
                        color: white;
                        cursor: pointer;
                        padding: 4px;
                        border-radius: 4px;
                        opacity: 0.7;
                        transition: opacity 0.2s ease;
                    " onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.7'">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `;
            
            notification.style.cssText = `
                background: ${colors[type] || colors.info};
                color: white;
                padding: 16px 20px;
                border-radius: 12px;
                font-weight: 500;
                margin-bottom: 12px;
                box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
                transform: translateX(120%);
                transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
                pointer-events: auto;
                word-wrap: break-word;
                backdrop-filter: blur(10px);
                border: 1px solid rgba(255, 255, 255, 0.1);
            `;
            
            // Add close button functionality
            const closeBtn = notification.querySelector('.notification-close');
            closeBtn.addEventListener('click', () => hideNotification(notification));
            
            notificationContainer.appendChild(notification);
            
            // Animate in
            setTimeout(() => {
                notification.style.transform = 'translateX(0)';
                notification.style.opacity = '1';
            }, 50);
            
            // Auto-hide after duration
            const hideTimeout = setTimeout(() => {
                hideNotification(notification);
            }, duration);
            
            // Pause auto-hide on hover
            notification.addEventListener('mouseenter', () => {
                clearTimeout(hideTimeout);
            });
            
            notification.addEventListener('mouseleave', () => {
                setTimeout(() => hideNotification(notification), 1000);
            });
            
            // Store timeout for potential cancellation
            notification._hideTimeout = hideTimeout;
        }
        
        function hideNotification(notification) {
            if (!notification.parentNode) return;
            
            notification.style.transform = 'translateX(120%)';
            notification.style.opacity = '0';
            
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
                isShowingNotification = false;
                
                // Process next notification in queue
                setTimeout(() => processNotificationQueue(), 200);
            }, 400);
        }
        
        function showSuccessNotification(message) {
            showNotification(message, 'success');
        }
        
        function showErrorNotification(message) {
            showNotification(message, 'error', 5000);
        }
        
        function showWarningNotification(message) {
            showNotification(message, 'warning');
        }
        
        function showInfoNotification(message) {
            showNotification(message, 'info');
        }
        
        // Progress notification for longer operations
        function showProgressNotification(message, progressCallback) {
            initNotificationSystem();
            
            const notification = document.createElement('div');
            notification.className = 'notification-toast progress';
            
            notification.innerHTML = `
                <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 8px;">
                    <i class="fas fa-spinner fa-spin"></i>
                    <span>${escapeHtml(message)}</span>
                </div>
                <div class="progress-bar" style="
                    width: 100%;
                    height: 4px;
                    background: rgba(255, 255, 255, 0.2);
                    border-radius: 2px;
                    overflow: hidden;
                ">
                    <div class="progress-fill" style="
                        width: 0%;
                        height: 100%;
                        background: white;
                        transition: width 0.3s ease;
                        border-radius: 2px;
                    "></div>
                </div>
            `;
            
            notification.style.cssText = `
                background: var(--sl-brand);
                color: white;
                padding: 16px 20px;
                border-radius: 12px;
                font-weight: 500;
                margin-bottom: 12px;
                box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
                transform: translateX(120%);
                transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
                pointer-events: auto;
                word-wrap: break-word;
            `;
            
            notificationContainer.appendChild(notification);
            
            setTimeout(() => {
                notification.style.transform = 'translateX(0)';
            }, 50);
            
            // Return progress updater
            return {
                updateProgress: (percentage) => {
                    const fill = notification.querySelector('.progress-fill');
                    if (fill) {
                        fill.style.width = `${Math.min(100, Math.max(0, percentage))}%`;
                    }
                },
                complete: (successMessage) => {
                    setTimeout(() => {
                        hideNotification(notification);
                        if (successMessage) {
                            showNotification(successMessage, 'success');
                        }
                    }, 500);
                },
                error: (errorMessage) => {
                    hideNotification(notification);
                    showNotification(errorMessage, 'error');
                }
            };
        }

        // Replace alert calls with notification system
        window.originalAlert = window.alert;
        window.originalConfirm = window.confirm;
        
        window.alert = function(message) {
            if (message.includes('successfully') || message.includes('created') || message.includes('updated') || message.includes('deleted')) {
                showNotification(message, 'success');
            } else if (message.includes('error') || message.includes('failed') || message.includes('invalid')) {
                showNotification(message, 'error');
            } else if (message.includes('warning') || message.includes('caution')) {
                showNotification(message, 'warning');
            } else {
                showNotification(message, 'info');
            }
        };
        
        // Enhanced confirm dialog with better styling
        window.confirm = function(message) {
            return new Promise((resolve) => {
                const confirmModal = document.createElement('div');
                confirmModal.className = 'confirm-modal';
                confirmModal.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    background: rgba(0, 0, 0, 0.5);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    z-index: 10001;
                    backdrop-filter: blur(2px);
                `;
                
                confirmModal.innerHTML = `
                    <div class="confirm-content" style="
                        background: white;
                        padding: 24px;
                        border-radius: 12px;
                        max-width: 400px;
                        margin: 20px;
                        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
                    ">
                        <h3 style="margin: 0 0 16px; color: var(--sl-neutral-900); font-size: 18px;">Confirm Action</h3>
                        <p style="margin: 0 0 24px; color: var(--sl-neutral-700); line-height: 1.5;">${escapeHtml(message)}</p>
                        <div style="display: flex; gap: 12px; justify-content: flex-end;">
                            <button class="btn btn-secondary cancel-btn">Cancel</button>
                            <button class="btn btn-primary confirm-btn">Confirm</button>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(confirmModal);
                
                // Focus confirm button
                setTimeout(() => {
                    confirmModal.querySelector('.confirm-btn').focus();
                }, 100);
                
                // Handle events
                confirmModal.querySelector('.cancel-btn').addEventListener('click', () => {
                    document.body.removeChild(confirmModal);
                    resolve(false);
                });
                
                confirmModal.querySelector('.confirm-btn').addEventListener('click', () => {
                    document.body.removeChild(confirmModal);
                    resolve(true);
                });
                
                // Handle escape key
                confirmModal.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape') {
                        document.body.removeChild(confirmModal);
                        resolve(false);
                    }
                });
                
                // Handle backdrop click
                confirmModal.addEventListener('click', (e) => {
                    if (e.target === confirmModal) {
                        document.body.removeChild(confirmModal);
                        resolve(false);
                    }
                });
            });
        };
        
        // Initialize notification system on load
        document.addEventListener('DOMContentLoaded', () => {
            initNotificationSystem();
        });
    </script>
    
    <!-- StudioLoop Business Context Annotation System -->
    <script src="annotations/annotation-system.js"></script>
</body>
</html>